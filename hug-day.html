<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2">
  <title>ü´Ç  HUG JOURNAL</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ------------------------------------------------------------
       HUG JOURNAL ‚Äî local heartbeat sound, real-time timer.
       Hold the button: world darkens, pulse begins, heartbeat plays,
       and you see exactly how long you're holding.
    ------------------------------------------------------------ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* DARKEN OVERLAY ‚Äî simulates embrace */
    #hug-veil {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(25, 15, 20, 0);
      pointer-events: none;
      z-index: 100;
      backdrop-filter: blur(0px);
      transition: background 0.25s ease, backdrop-filter 0.25s ease;
    }

    .hug-veil-active {
      background: rgba(30, 18, 22, 0.45) !important;
      backdrop-filter: blur(2px) !important;
    }

    /* HEARTBEAT PULSE ‚Äî subtle, organic */
    @keyframes heartbeat {
      0% { transform: scale(1); }
      30% { transform: scale(1.05); }
      50% { transform: scale(1); }
      70% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    .heartbeat-pulse {
      animation: heartbeat 1.4s infinite ease-in-out;
    }

    body {
      background: #f4ece9;
      background-image: radial-gradient(circle at 15% 30%, #fbe9e5 0%, #f4e3df 70%, #efe5e2 100%);
      font-family: 'Quicksand', sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      color: #2d2a2a;
    }

    .journal-container {
      max-width: 720px;
      width: 100%;
      background: rgba(255, 250, 245, 0.75);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 48px 48px 48px 16px;
      padding: 36px 28px;
      box-shadow: 0 25px 40px rgba(90, 60, 60, 0.12),
                  inset 0 0 0 1px rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.4);
      position: relative;
      z-index: 10;
    }

    .journal-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 28px;
      border-bottom: 2px solid #e5d5cf;
      padding-bottom: 16px;
    }

    h1 {
      font-size: 2.3rem;
      font-weight: 600;
      color: #4c3b37;
      letter-spacing: -0.5px;
    }

    .date-stamp {
      font-weight: 600;
      color: #8c6e68;
      background: rgba(255, 235, 230, 0.7);
      padding: 8px 16px;
      border-radius: 40px;
      font-size: 0.9rem;
      border: 1px solid #fff;
    }

    /* today's mood */
    .today-mood {
      background: rgba(245, 235, 230, 0.7);
      border-radius: 40px;
      padding: 22px 20px;
      margin-bottom: 30px;
      border: 1px solid white;
    }

    .mood-ask {
      font-weight: 700;
      color: #5d4742;
      margin-bottom: 16px;
      font-size: 1.1rem;
    }

    .mood-choices {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .mood-word {
      background: white;
      border: 1px solid #e7d3cd;
      padding: 10px 20px;
      border-radius: 60px;
      font-weight: 600;
      color: #57413c;
      box-shadow: 0 2px 0 #dac2bb;
      transition: 0.03s;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .mood-word.active {
      background: #ffe8e1;
      border: 2px solid #c48a7c;
      box-shadow: 0 3px 0 #b07669;
      color: #3e2e2b;
    }

    /* HUG BUTTON ‚Äî now with real-time timer display */
    .hug-anchor {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 24px 0 32px;
    }

    .hug-core {
      width: 200px;
      height: 200px;
      background: radial-gradient(circle at 30% 30%, #f5dbd2, #eccbc2);
      border-radius: 50% 50% 45% 55% / 55% 45% 55% 45%;
      border: 4px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 12px 0 #b4938a, 0 18px 30px rgba(110, 70, 60, 0.18);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      font-weight: 600;
      color: #342824;
      cursor: pointer;
      transition: 0.02s;
      animation: gentleDrift 6s infinite alternate ease-in-out;
    }

    @keyframes gentleDrift {
      0% { transform: translateY(0); }
      100% { transform: translateY(-8px); }
    }

    .hug-hold-glow {
      box-shadow: 0 0 0 18px rgba(200, 150, 140, 0.3), 0 12px 0 #b4938a !important;
    }

    /* REAL-TIME HOLD TIMER ‚Äî big, clear, present */
    .hold-timer {
      margin-top: 16px;
      background: rgba(255, 255, 255, 0.8);
      padding: 14px 28px;
      border-radius: 100px;
      border: 2px solid white;
      font-size: 1.8rem;
      font-weight: 800;
      color: #5c3b36;
      box-shadow: 0 6px 0 #cfa89e;
      display: inline-block;
      transition: all 0.1s;
      letter-spacing: 2px;
    }

    .time-keeper {
      background: rgba(250, 240, 235, 0.8);
      border-radius: 100px;
      padding: 16px 24px;
      margin: 16px 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid white;
      font-weight: 600;
    }

    .total-time {
      background: white;
      padding: 8px 24px;
      border-radius: 60px;
      color: #5c403b;
      font-weight: 700;
      font-size: 1.4rem;
      border: 1px solid #e3cbc4;
    }

    /* journal entry */
    .entry-page {
      background: #fffcf9;
      border-radius: 32px 32px 32px 8px;
      padding: 28px 24px;
      margin: 28px 0 16px;
      border: 1px solid #ffeae3;
      box-shadow: inset 0 0 0 1px white, 0 6px 0 #cfb6af;
    }

    .entry-title {
      font-weight: 700;
      color: #6e4f48;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      font-size: 1.2rem;
    }

    .entry-content {
      font-size: 1.15rem;
      line-height: 1.6;
      color: #352d2b;
      font-weight: 500;
      min-height: 80px;
    }

    .entry-footer {
      margin-top: 20px;
      color: #95746b;
      font-weight: 600;
      font-size: 0.85rem;
      display: flex;
      justify-content: space-between;
      border-top: 1px dashed #e2cec7;
      padding-top: 16px;
    }

    /* history */
    .history-scroll {
      background: rgba(245, 237, 233, 0.6);
      border-radius: 40px 40px 40px 8px;
      padding: 22px 20px;
      margin-top: 24px;
      border: 1px solid white;
    }

    .history-title {
      font-weight: 700;
      color: #6f554f;
      margin-bottom: 16px;
      font-size: 1.1rem;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .history-item {
      background: white;
      padding: 12px 18px;
      border-radius: 30px;
      border: 1px solid #f2dbd4;
      color: #4f3d39;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
    }

    .presence-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
      justify-content: flex-end;
    }

    .presence-btn {
      background: transparent;
      border: 2px solid #e1cbc5;
      padding: 12px 18px;
      border-radius: 50px;
      font-weight: 700;
      color: #6f5350;
      transition: 0.1s;
      cursor: pointer;
      background: rgba(255, 250, 245, 0.5);
    }

    .presence-btn:hover {
      background: #ffe7e0;
      border-color: #cfa89e;
    }

    .float-reminder {
      position: fixed;
      pointer-events: none;
      font-size: 1.8rem;
      opacity: 0.1;
      animation: rise 25s infinite linear;
      z-index: 0;
    }

    @keyframes rise {
      0% { transform: translateY(110vh) rotate(0deg); opacity: 0.05; }
      80% { opacity: 0.15; }
      100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>

<!-- DARKEN VEIL -->
<div id="hug-veil"></div>

<!-- FLOATING ELEMENTS -->
<div id="airborne"></div>

<!-- 
  HEARTBEAT SOUND ‚Äî from assets folder 
  USING LOCAL FILE: assets/heartbeat.mp3
  (you need to place your heartbeat sound file there)
-->
<audio id="heartbeatAudio" loop preload="auto">
  <source src="assets/sounds/heartbeat.mp3" type="audio/mpeg">
  <!-- fallback message if file not found -->
  Your browser doesn't support the heartbeat sound or the file is missing.
  Please add assets/heartbeat.mp3 to your project.
</audio>

<main class="journal-container" id="journalContainer">

  <div class="journal-header">
    <h1>ü´Ç  hug journal</h1>
    <span class="date-stamp" id="todayDate"></span>
  </div>

  <!-- MOOD SELECTION -->
  <div class="today-mood">
    <div class="mood-ask">how are you, really?</div>
    <div class="mood-choices" id="moodSelection">
      <button class="mood-word" data-mood="heavy">üåßÔ∏è heavy</button>
      <button class="mood-word" data-mood="quiet">üçÇ quiet</button>
      <button class="mood-word active" data-mood="still">üïØÔ∏è still</button>
      <button class="mood-word" data-mood="tender">üïäÔ∏è tender</button>
      <button class="mood-word" data-mood="grateful">‚ú® grateful</button>
      <button class="mood-word" data-mood="weary">üïØÔ∏è weary</button>
    </div>
  </div>

  <!-- HUG BUTTON + REAL-TIME HOLD TIMER -->
  <div class="hug-anchor">
    <button class="hug-core" id="hugCenter">
      <span style="font-size: 2.8rem;">ü´Ç</span>
      <span style="font-size: 0.95rem; margin-top: 4px;">hold ‚Äî hear the beat</span>
    </button>
    <!-- THIS IS THE REAL-TIME HOLD TIMER ‚Äî updates every 100ms while hugging -->
    <div class="hold-timer" id="holdTimerDisplay">0.0s</div>
  </div>

  <!-- LIFETIME HUG TIME -->
  <div class="time-keeper">
    <span style="font-weight: 700; color: #5e4540;">lifetime hugs</span>
    <span class="total-time" id="totalHugTimeDisplay">0m 0s</span>
  </div>

  <!-- JOURNAL ENTRY -->
  <div class="entry-page">
    <div class="entry-title">
      <span>üìì</span> today's entry
    </div>
    <div class="entry-content" id="journalEntry">
      press and hold the hug. feel the heartbeat.
    </div>
    <div class="entry-footer">
      <span id="hugMoodTag">mood ¬∑ still</span>
      <span id="hugDurationTag"></span>
    </div>
  </div>

  <!-- HUG HISTORY -->
  <div class="history-scroll">
    <div class="history-title">üìã recent hugs ¬∑ real seconds</div>
    <div class="history-list" id="historyContainer">
      <div class="history-item">ü´Ç your hugs will appear here</div>
    </div>
  </div>

  <!-- REFLECTION ACTIONS -->
  <div class="presence-actions">
    <div class="presence-btn" id="reflectBtn">üïØÔ∏è reflect</div>
    <div class="presence-btn" id="clearHistoryBtn" style="border-color: #dfc2bb;">üï∏Ô∏è let go</div>
  </div>
</main>

<script>
  // -------------------------------------------------------------
  //  ü´Ç  HUG JOURNAL ‚Äî LOCAL HEARTBEAT + REAL-TIME HOLD TIMER
  //  Hold the button: 
  //  - world darkens
  //  - heartbeat animation pulses
  //  - LOCAL heartbeat sound plays from assets/heartbeat.mp3
  //  - YOU SEE EXACTLY HOW LONG YOU'RE HOLDING (real-time)
  // -------------------------------------------------------------
  (function() {
    // Create floating atmosphere
    function createAtmosphere() {
      let air = document.getElementById('airborne');
      for (let i = 0; i < 10; i++) {
        let el = document.createElement('div');
        el.className = 'float-reminder';
        el.innerHTML = ['ü´Ç', 'ü§ç', 'üïØÔ∏è', 'üïäÔ∏è'][Math.floor(Math.random() * 4)];
        el.style.left = Math.random() * 100 + '%';
        el.style.animationDelay = Math.random() * 12 + 's';
        el.style.fontSize = (Math.random() * 20 + 20) + 'px';
        el.style.animationDuration = (Math.random() * 16 + 22) + 's';
        air.appendChild(el);
      }
    }
    createAtmosphere();

    // DOM elements
    const veil = document.getElementById('hug-veil');
    const hugBtn = document.getElementById('hugCenter');
    const journalContainer = document.querySelector('.journal-container');
    const heartbeatSound = document.getElementById('heartbeatAudio');
    const holdTimerDisplay = document.getElementById('holdTimerDisplay');
    const totalDisplay = document.getElementById('totalHugTimeDisplay');
    const journalEntry = document.getElementById('journalEntry');
    const hugMoodTag = document.getElementById('hugMoodTag');
    const hugDurationTag = document.getElementById('hugDurationTag');
    const historyContainer = document.getElementById('historyContainer');
    const todayDateSpan = document.getElementById('todayDate');
    const moodBtns = document.querySelectorAll('.mood-word');

    // ---------- STATE ----------
    let mood = 'still';
    let totalSeconds = Number(localStorage.getItem('hj_totalSeconds') || 0);
    let totalHugs = Number(localStorage.getItem('hj_hugCount') || 0);
    
    // Hug history
    let hugHistory = [];
    try {
      hugHistory = JSON.parse(localStorage.getItem('hj_history') || '[]');
    } catch(e) { hugHistory = []; }

    // ---------- TODAY'S DATE ----------
    const today = new Date();
    const options = { month: 'short', day: 'numeric', year: 'numeric' };
    todayDateSpan.textContent = today.toLocaleDateString('en-US', options);

    // ---------- UPDATE TOTAL TIME DISPLAY ----------
    function updateTotalTime() {
      let mins = Math.floor(totalSeconds / 60);
      let secs = Math.floor(totalSeconds % 60);
      totalDisplay.textContent = `${mins}m ${secs}s`;
    }

    // ---------- ADD SECONDS ----------
    function addSeconds(sec) {
      totalSeconds = Math.round((totalSeconds + sec) * 10) / 10;
      localStorage.setItem('hj_totalSeconds', totalSeconds);
      updateTotalTime();
    }

    // ---------- RECORD HUG ----------
    function recordHug(duration, moodUsed) {
      totalHugs++;
      localStorage.setItem('hj_hugCount', totalHugs);

      const timestamp = new Date();
      const timeStr = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const dateStr = timestamp.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      
      const hugRecord = {
        id: Date.now() + Math.random(),
        date: dateStr,
        time: timeStr,
        duration: duration,
        mood: moodUsed,
      };

      hugHistory.unshift(hugRecord);
      if (hugHistory.length > 8) hugHistory.pop();
      localStorage.setItem('hj_history', JSON.stringify(hugHistory));
      
      renderHistory();
    }

    // ---------- RENDER HISTORY ----------
    function renderHistory() {
      if (!historyContainer) return;
      if (hugHistory.length === 0) {
        historyContainer.innerHTML = '<div class="history-item">ü´Ç no hugs yet ‚Äî they will come</div>';
        return;
      }
      let html = '';
      hugHistory.slice(0, 6).forEach(h => {
        html += `<div class="history-item">
                    <span>ü´Ç ${h.date} ¬∑ ${h.time}</span>
                    <span style="background: #f3e1db; padding: 4px 14px; border-radius: 50px;">${h.duration.toFixed(1)}s ¬∑ ${h.mood}</span>
                  </div>`;
      });
      historyContainer.innerHTML = html;
    }

    // ---------- MOOD SWITCHER ----------
    moodBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        moodBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        mood = this.dataset.mood;
        hugMoodTag.textContent = `mood ¬∑ ${mood}`;
      });
    });
    hugMoodTag.textContent = `mood ¬∑ still`;

    // --------------------------------------------------------
    //  üíì  HEARTBEAT + DARKEN + SOUND + REAL-TIME TIMER
    // --------------------------------------------------------
    let heartbeatInterval = null;
    let hugging = false;
    let hugStart = null;
    let timerInterval = null;

    function startHug(e) {
      if (hugging) return;
      hugging = true;
      hugStart = Date.now();
      
      // DARKEN
      veil.classList.add('hug-veil-active');
      
      // HEARTBEAT ANIMATION
      hugBtn.classList.add('hug-hold-glow', 'heartbeat-pulse');
      journalContainer.classList.add('heartbeat-pulse');
      
      // PLAY LOCAL HEARTBEAT SOUND (from assets folder)
      if (heartbeatSound) {
        heartbeatSound.currentTime = 0;
        heartbeatSound.play().catch(e => {
          console.log('heartbeat audio could not be played ‚Äî check assets/heartbeat.mp3');
          // Still hug, even without sound
        });
      }
      
      // VEIL OPACITY PULSE
      if (heartbeatInterval) clearInterval(heartbeatInterval);
      let beatCount = 0;
      heartbeatInterval = setInterval(() => {
        if (hugging) {
          veil.style.background = `rgba(30, 18, 22, ${0.45 + Math.sin(beatCount * 1.2) * 0.04})`;
          beatCount++;
        }
      }, 180);
      
      // ---------- REAL-TIME HOLD TIMER ‚Äî updates every 100ms ----------
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (hugging && hugStart) {
          let elapsed = (Date.now() - hugStart) / 1000;
          // Update the big hold timer display in REAL TIME
          holdTimerDisplay.textContent = elapsed.toFixed(1) + 's';
        }
      }, 100);
    }

    function endHug() {
      if (!hugging) return;
      hugging = false;
      
      // REMOVE DARKEN & HEARTBEAT
      veil.classList.remove('hug-veil-active');
      veil.style.background = '';
      
      hugBtn.classList.remove('hug-hold-glow', 'heartbeat-pulse');
      journalContainer.classList.remove('heartbeat-pulse');
      
      // STOP HEARTBEAT SOUND
      if (heartbeatSound) {
        heartbeatSound.pause();
        heartbeatSound.currentTime = 0;
      }
      
      if (heartbeatInterval) {
        clearInterval(heartbeatInterval);
        heartbeatInterval = null;
      }
      
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      if (hugStart) {
        let duration = (Date.now() - hugStart) / 1000;
        duration = Math.round(duration * 10) / 10;
        
        // Reset hold timer display to 0.0s
        holdTimerDisplay.textContent = '0.0s';
        
        // Add to total time
        addSeconds(duration);
        
        // Record hug
        recordHug(duration, mood);
        
        // JOURNAL ENTRY
        const moodMessages = {
          heavy: 'Hold me tight, dont let me go alright?',
          quiet: 'Wanna stay like this forever',
          still: 'you stayed. sometimes that‚Äôs the whole thing. just staying',
          tender: 'I can feel it for some reason.',
          grateful: 'this moment, this breath. thank you for being here.',
          weary: 'you rested here. i hope it felt like coming home.'
        };
        let message = moodMessages[mood] || 'you held and were held. the hug was mabey not real, but the time you spent on it was.';
        
        let timeString = duration.toFixed(1) + 's';
        if (duration >= 60) {
          let mins = Math.floor(duration / 60);
          let secs = Math.floor(duration % 60);
          timeString = `${mins}m ${secs}s`;
        }
        
        journalEntry.textContent = `ü´Ç  ${message}`;
        hugDurationTag.textContent = `${timeString} ¬∑ ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        
        hugStart = null;
      }
    }

    // EVENT LISTENERS
    hugBtn.addEventListener('mousedown', startHug);
    hugBtn.addEventListener('touchstart', startHug);
    document.addEventListener('mouseup', endHug);
    document.addEventListener('touchend', endHug);
    window.addEventListener('blur', endHug);

    // ---------- REFLECT ----------
    document.getElementById('reflectBtn').addEventListener('click', function() {
      let reflections = [
        'you have held me for ' + Math.floor(totalSeconds / 60) + ' minutes in total. each second, is a of care.',
        'who said a hug cant fix everything, all i want after a rough day is a hug from you',
        'your most recent hug was ' + (hugHistory[0] ? hugHistory[0].duration.toFixed(1) + 's' : 'waiting for you') + '. it matters.',
        'this journal doesn‚Äôt keep score. it keeps you.',
        'some days are heavy. some are light. all it takes to fix it is to be held.'
      ];
      let randomReflection = reflections[Math.floor(Math.random() * reflections.length)];
      journalEntry.textContent = 'üïØÔ∏è ' + randomReflection;
    });

    // ---------- LET GO ----------
    document.getElementById('clearHistoryBtn').addEventListener('click', function() {
      if (confirm('let go of hug history? the seconds stay with you, but the list will fade.')) {
        hugHistory = [];
        localStorage.setItem('hj_history', JSON.stringify([]));
        renderHistory();
        journalEntry.textContent = 'üï∏Ô∏è you let go. the hugs still happened. you don‚Äôt need to prove them.';
      }
    });

    // ---------- INIT ----------
    function init() {
      updateTotalTime();
      renderHistory();
      if (hugHistory.length === 0) {
        historyContainer.innerHTML = '<div class="history-item">ü´Ç your hugs will appear here. real seconds, not points.</div>';
      }
    }
    init();

    setTimeout(() => {
      if (journalEntry.textContent.includes('press and hold')) {
        journalEntry.textContent = 'üïØÔ∏è this journal holds whatever you bring to it. start with a hug.';
      }
    }, 200);
  })();
</script>

<!-- 
  INSTRUCTION FOR YOU:
  Place your heartbeat sound file at: assets/heartbeat.mp3
  The file will be loaded from that relative path.
  Supported formats: .mp3, .ogg, .wav ‚Äî change the <source> if needed.
-->
</body>
</html>
