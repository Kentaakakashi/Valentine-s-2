<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.2" />
  <title>ğŸ«‚ hug time Â· forever hold</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* OPTIMIZED: no heavy filters, no infinite loops that leak, no audio, pure hug */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, #ffe4ec, #ffe0ed, #ffe9f0);
      font-family: 'Quicksand', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 16px;
      color: #402a33;
    }

    .cozy-container {
      max-width: 650px;
      width: 100%;
      background: rgba(255, 250, 245, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 80px 80px 80px 80px;
      padding: 32px 24px;
      box-shadow: 0 20px 40px rgba(250, 130, 160, 0.2),
                  inset 0 4px 12px rgba(255, 255, 255, 0.9);
      border: 4px solid rgba(255, 255, 255, 0.8);
      transition: all 0.2s;
    }

    h1 {
      font-size: 2.8rem;
      font-weight: 800;
      display: flex;
      justify-content: center;
      gap: 10px;
      color: #512a38;
      text-shadow: 0 6px 0 #ffc0cb, 0 12px 20px #ffa5b9;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .soft-quote {
      background: #fff0f5dd;
      padding: 14px 20px;
      border-radius: 100px;
      border: 3px dashed #ff889d;
      font-weight: 700;
      margin-bottom: 24px;
      font-size: 1.1rem;
    }

    /* MOOD - super light */
    .mood-corner {
      background: rgba(255, 235, 245, 0.6);
      border-radius: 70px;
      padding: 18px 12px;
      margin-bottom: 16px;
      border: 2px solid white;
    }

    .mood-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }

    .mood-pill {
      background: white;
      border: 3px solid white;
      padding: 10px 20px;
      border-radius: 60px;
      font-weight: 700;
      color: #452830;
      box-shadow: 0 5px 0 #d68e99;
      transition: 0.06s linear;
      cursor: pointer;
      font-size: 0.95rem;
    }

    .mood-pill.active {
      background: #ffdee8;
      border: 3px solid #ff4f6c;
      box-shadow: 0 6px 0 #f34a62;
      transform: scale(1.02);
    }

    /* HUG ZONE â€” NO LEAKS, SMOOTH */
    .hug-zone {
      position: relative;
      margin: 18px 0 24px;
    }

    .hug-planet {
      width: 210px;
      height: 210px;
      margin: 0 auto;
      border-radius: 50% 50% 45% 55% / 55% 45% 55% 45%;
      background: radial-gradient(circle at 30% 30%, #ffbfcc, #ffaaba, #ff97aa);
      border: 7px solid white;
      box-shadow: 0 20px 0 #9e6972, 0 30px 50px #ff95a8a0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1.9rem;
      font-weight: 900;
      color: #341f26;
      cursor: pointer;
      transition: 0.02s;
      animation: float 4s infinite alternate;
    }

    @keyframes float {
      0% { transform: translateY(0) scale(1); }
      100% { transform: translateY(-12px) scale(1.01); }
    }

    .hug-glow {
      box-shadow: 0 0 0 20px rgba(255, 180, 200, 0.5), 0 20px 0 #9e6972 !important;
      transition: 0s;
    }

    /* TIMER â€” big and clear */
    .time-castle {
      background: #ffe5ecf0;
      border-radius: 70px;
      padding: 22px 18px;
      border: 4px solid white;
      margin-bottom: 20px;
    }

    .total-time {
      font-size: 2.1rem;
      font-weight: 900;
      background: white;
      display: inline-block;
      padding: 8px 28px;
      border-radius: 80px;
      border: 4px solid #ffb6c1;
      color: #732434;
    }

    .current-hug-badge {
      background: white;
      border-radius: 60px;
      padding: 12px 28px;
      font-size: 1.8rem;
      font-weight: 900;
      border: 4px solid #ffa5b4;
    }

    /* stats row */
    .stats-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }

    .stat-puff {
      background: #ffedf1;
      border-radius: 40px;
      padding: 16px 14px;
      flex: 1 1 130px;
      border: 4px solid white;
      font-weight: 800;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 5px 0 #c88f99;
    }

    .stat-num {
      font-size: 2rem;
      font-weight: 900;
      color: #8f4352;
    }

    /* calendar */
    .week-hugs {
      background: #ffe0e8f0;
      border-radius: 60px;
      padding: 16px 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 4px solid white;
      margin-bottom: 18px;
      font-weight: 800;
    }

    .dot-calendar {
      display: flex;
      gap: 12px;
      font-size: 1.9rem;
    }

    /* message area â€” snappy */
    .message-nest {
      background: #fff7f9;
      border-radius: 80px 80px 80px 20px;
      padding: 20px 22px;
      border: 5px solid white;
      box-shadow: 0 8px 0 #dc9ca6;
      font-size: 1.2rem;
      font-weight: 700;
      margin: 16px 0 14px;
      min-height: 95px;
      transition: 0.15s;
    }

    /* hug tools â€” all clickable, no lag */
    .tool-family {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    .tool-btn {
      background: white;
      border: 4px solid #ffbfcb;
      padding: 12px 18px;
      border-radius: 50px;
      font-weight: 800;
      color: #48262f;
      box-shadow: 0 6px 0 #af7a84;
      transition: 0.03s;
      cursor: pointer;
      flex: 1 0 130px;
    }

    .tool-btn:active {
      transform: translateY(6px);
      box-shadow: 0 1px 0 #af7a84;
    }

    .dynamic-area {
      margin-top: 20px;
      background: rgba(255, 245, 250, 0.7);
      border-radius: 70px;
      padding: 18px;
      border: 4px solid white;
      min-height: 90px;
      transition: 0.1s;
    }

    /* floating only hugs â€” very few, optimized */
    .hug-float {
      position: fixed;
      pointer-events: none;
      font-size: 2.2rem;
      opacity: 0.2;
      animation: rise 24s infinite linear;
      z-index: 0;
    }

    @keyframes rise {
      0% { transform: translateY(110vh) rotate(0deg); opacity: 0.1; }
      70% { opacity: 0.3; }
      100% { transform: translateY(-20vh) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>

<!-- very few floating hugs, no perf hit -->
<div id="hugAtmosphere"></div>

<div class="cozy-container">
  <h1>ğŸ«‚  HUG TIME</h1>
  <div class="soft-quote">âœ§  every second you hold is felt  âœ§</div>

  <!-- mood â€” instant switch -->
  <div class="mood-corner">
    <div style="font-weight:800; margin-bottom:8px;">ğŸŒ¸ how are you?</div>
    <div class="mood-grid" id="moodGrid">
      <button class="mood-pill" data-mood="low">ğŸŒ§ï¸ low</button>
      <button class="mood-pill" data-mood="meh">ğŸƒ meh</button>
      <button class="mood-pill active" data-mood="okay">â˜ï¸ okay</button>
      <button class="mood-pill" data-mood="emotional">ğŸ¥¹ emotional</button>
      <button class="mood-pill" data-mood="loved">ğŸ’˜ loved</button>
      <button class="mood-pill" data-mood="anxious">ğŸŒ€ anxious</button>
    </div>
  </div>

  <!-- MAIN HUG BUTTON â€” performance optimized, no interval leaks -->
  <div class="hug-zone">
    <button class="hug-planet" id="hugCore">ğŸ«‚ hold</button>
  </div>

  <!-- TIME KINGDOM -->
  <div class="time-castle">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
      <span style="font-weight:900; font-size:1.4rem;">â±ï¸ lifetime hug</span>
      <span class="total-time" id="totalTimeDisplay">0m 0s</span>
    </div>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px;">
      <span style="font-weight:900;">this hug</span>
      <span class="current-hug-badge" id="currentHugTimer">0.0s</span>
    </div>
  </div>

  <!-- STATS: HUG COUNT, STREAK, MILESTONE -->
  <div class="stats-row">
    <div class="stat-puff">
      <span style="font-size:1.8rem;">ğŸ«‚</span>
      <span class="stat-num" id="hugCountDisplay">0</span>
      <span>hugs</span>
    </div>
    <div class="stat-puff">
      <span style="font-size:1.8rem;">ğŸ”¥</span>
      <span class="stat-num" id="streakDisplay">0</span>
      <span>streak</span>
    </div>
    <div class="stat-puff">
      <span style="font-size:1.8rem;">ğŸ†</span>
      <span class="stat-num" id="milestoneDisplay">0</span>
      <span>mins</span>
    </div>
  </div>

  <!-- WEEK CALENDAR â€” super light -->
  <div class="week-hugs">
    <span style="font-size:1.8rem;">ğŸ“†</span>
    <span style="font-weight:900;">hug week</span>
    <div class="dot-calendar" id="calendarDots">â—‹ â—‹ â—‹ â—‹ â—‹ â—‹ â—‹</div>
  </div>

  <!-- MESSAGE FROM HUG -->
  <div class="message-nest" id="hugMessage">ğŸ«‚ hold to begin your hug</div>

  <!-- HUG EXTRAS â€” all visual, no audio, no lag -->
  <div class="tool-family">
    <div class="tool-btn" id="couponTool">ğŸŸï¸ hug coupon</div>
    <div class="tool-btn" id="milestoneTool">â³ hug minute</div>
    <div class="tool-btn" id="letterTool">ğŸ’Œ comfort letter</div>
    <div class="tool-btn" id="memoryTool">ğŸ“– hug memory</div>
    <div class="tool-btn" id="breatheTool">ğŸ« breathe</div>
  </div>

  <!-- DYNAMIC REWARD / COUPON AREA (no heavy animation) -->
  <div class="dynamic-area" id="dynamicZone">
    âœ¨ your hug extras appear here
  </div>
</div>

<script>
  (function() {
    // ----------------------------------------------------
    // ğŸ«‚  HUG TIME â€” 100% AUDIO FREE, ZERO LEAKS, FAST
    // ----------------------------------------------------

    // ---- FLOATING HUGS (very few, to avoid "unresponsive") ----
    function addHugFloats() {
      let atm = document.getElementById('hugAtmosphere');
      for (let i = 0; i < 12; i++) {  // reduced count for smoothness
        let fl = document.createElement('div');
        fl.className = 'hug-float';
        fl.innerHTML = ['ğŸ«‚','ğŸ¤','ğŸ«‚','ğŸ§¸','ğŸ«‚','â˜ï¸'][Math.floor(Math.random() * 6)];
        fl.style.left = Math.random() * 100 + '%';
        fl.style.animationDelay = Math.random() * 12 + 's';
        fl.style.fontSize = (Math.random() * 24 + 24) + 'px';
        fl.style.animationDuration = (Math.random() * 12 + 18) + 's';
        atm.appendChild(fl);
      }
    }
    addHugFloats();

    // ---------- STATE (no memory leaks, clean intervals) ----------
    let mood = 'okay';
    let hugging = false;
    let hugStart = null;
    let totalSeconds = Number(localStorage.getItem('hugTotalSeconds') || 0);
    let hugCount = Number(localStorage.getItem('hugCount') || 0);
    let streak = Number(localStorage.getItem('hugStreak') || 0);
    let lastHugDate = localStorage.getItem('lastHugDate') || '';

    // Timer handle
    let timerInterval = null;

    // DOM references
    const hugCore = document.getElementById('hugCore');
    const totalTimeDisplay = document.getElementById('totalTimeDisplay');
    const currentHugTimer = document.getElementById('currentHugTimer');
    const hugCountDisplay = document.getElementById('hugCountDisplay');
    const streakDisplay = document.getElementById('streakDisplay');
    const milestoneDisplay = document.getElementById('milestoneDisplay');
    const calendarDots = document.getElementById('calendarDots');
    const hugMessage = document.getElementById('hugMessage');
    const dynamicZone = document.getElementById('dynamicZone');

    // Mood pills
    const moodPills = document.querySelectorAll('.mood-pill');
    moodPills.forEach(p => {
      p.addEventListener('click', function(e) {
        moodPills.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        mood = this.dataset.mood;
      });
    });

    // ---------- MESSAGES ----------
    const hugReplies = {
      low: ['holding you softly', 'you can lean on me', 'iâ€™ve got you'],
      meh: ['here, in the quiet', 'a gentle squeeze', 'iâ€™m with you'],
      okay: ['youâ€™re doing great', 'warmth surrounds you', 'proud of you'],
      emotional: ['let it out, sweetheart', 'feel it all', 'iâ€™ll hold you through'],
      loved: ['you are so loved', 'this hug celebrates you', 'your heart glows'],
      anxious: ['breathe inâ€¦ outâ€¦', 'you are safe', 'grounded in this hug'],
    };

    // ----- UPDATE TOTAL TIME DISPLAY -----
    function updateTotalDisplay() {
      let mins = Math.floor(totalSeconds / 60);
      let secs = Math.floor(totalSeconds % 60);
      totalTimeDisplay.textContent = `${mins}m ${secs}s`;
      milestoneDisplay.textContent = mins;
    }

    // ----- ADD SECONDS TO TOTAL (only called on hug end) -----
    function addHugSeconds(sec) {
      totalSeconds += sec;
      localStorage.setItem('hugTotalSeconds', totalSeconds);
      updateTotalDisplay();
    }

    // ----- STREAK & CALENDAR -----
    function refreshStreakAndCalendar() {
      const today = new Date().toDateString();
      if (lastHugDate !== today) {
        let yest = new Date();
        yest.setDate(yest.getDate() - 1);
        if (lastHugDate === yest.toDateString()) {
          streak++;
        } else {
          streak = 1;
        }
        lastHugDate = today;
        localStorage.setItem('lastHugDate', today);
        localStorage.setItem('hugStreak', streak);
      }
      streakDisplay.textContent = streak;

      // 7-day calendar (lightweight)
      let dots = '';
      for (let i = 6; i >= 0; i--) {
        let d = new Date();
        d.setDate(d.getDate() - i);
        let dateStr = d.toDateString();
        let mark = 'â—‹';
        if (dateStr === today) mark = 'ğŸ«‚';
        else if (localStorage.getItem('hugmark_' + dateStr)) mark = 'ğŸ¤';
        dots += mark + ' ';
      }
      calendarDots.textContent = dots;
    }

    function markHugDay() {
      const today = new Date().toDateString();
      localStorage.setItem('hugmark_' + today, 'ğŸ¤');
      refreshStreakAndCalendar();
    }

    // ----- HUG START (clean, no memory buildup) -----
    function onStartHug(e) {
      if (hugging) return;
      hugging = true;
      hugStart = Date.now();
      hugCore.classList.add('hug-glow');
      hugMessage.classList.remove('show'); // not needed but we remove style
      // start timer update (RAF later)
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (hugging && hugStart) {
          let elapsed = (Date.now() - hugStart) / 1000;
          currentHugTimer.textContent = elapsed.toFixed(1) + 's';
        }
      }, 100);
    }

    // ----- HUG END (all updates happen once) -----
    function onEndHug() {
      if (!hugging) return;
      hugging = false;
      hugCore.classList.remove('hug-glow');
      
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      if (hugStart) {
        let duration = (Date.now() - hugStart) / 1000;
        duration = Math.round(duration * 10) / 10; // .1s precision
        
        // increment total time
        addHugSeconds(duration);
        
        // hug count +1
        hugCount++;
        localStorage.setItem('hugCount', hugCount);
        hugCountDisplay.textContent = hugCount;
        
        // mark day & streak
        markHugDay();

        // display message
        let moodSet = hugReplies[mood] || hugReplies.okay;
        let randomMsg = moodSet[Math.floor(Math.random() * moodSet.length)];
        hugMessage.textContent = `ğŸ«‚ ${randomMsg}  Â·  ${duration.toFixed(1)}s hug`;

        // push to hug memory (last 3)
        let mem = JSON.parse(localStorage.getItem('hugMemoryList') || '[]');
        mem.push(`${duration.toFixed(1)}s (${mood})`);
        if (mem.length > 5) mem.shift();
        localStorage.setItem('hugMemoryList', JSON.stringify(mem));

        // reset current timer display
        currentHugTimer.textContent = '0.0s';
        hugStart = null;
      }
    }

    // attach listeners (no double)
    hugCore.addEventListener('mousedown', onStartHug);
    hugCore.addEventListener('touchstart', onStartHug);
    document.addEventListener('mouseup', onEndHug);
    document.addEventListener('touchend', onEndHug);
    window.addEventListener('blur', onEndHug); // safety

    // ----- initial UI update -----
    function initUI() {
      hugCountDisplay.textContent = hugCount;
      streakDisplay.textContent = streak;
      updateTotalDisplay();
      refreshStreakAndCalendar();
    }
    initUI();

    // ----- HUG COUPON -----
    document.getElementById('couponTool').addEventListener('click', function() {
      dynamicZone.innerHTML = `
        <div style="background:#fff0f5; border-radius:50px; padding:16px; display:flex; justify-content:space-between; align-items:center; border:4px dashed #ff7e97;">
          <span style="font-weight:900;">ğŸŸï¸ one hug Â· redeem anytime</span>
          <button style="background:white; border:4px solid #ffb6c1; border-radius:50px; padding:8px 24px; font-weight:900;" id="copyCouponNow">copy</button>
        </div>
      `;
      document.getElementById('copyCouponNow')?.addEventListener('click', function() {
        navigator.clipboard?.writeText('ğŸ«‚âœ¨ good for 1 hug â€“ redeem with warmth');
        dynamicZone.innerHTML = 'ğŸ’Œ coupon copied!';
      });
    });

    // ----- MILESTONE (hug minute celebration) -----
    document.getElementById('milestoneTool').addEventListener('click', function() {
      let mins = Math.floor(totalSeconds / 60);
      dynamicZone.innerHTML = `ğŸ† <span style="font-weight:900;font-size:1.3rem;">you've hugged for ${mins} minute${mins!==1?'s':''}!</span> ğŸ†`;
    });

    // ----- COMFORT LETTER -----
    document.getElementById('letterTool').addEventListener('click', function() {
      let letters = [
        'you are allowed to take up space.',
        'somewhere, someone is grateful for you.',
        'your heart is gentle and needed.',
        'rest is not weakness.',
        'this hug is real and so are you.'
      ];
      let chosen = letters[Math.floor(Math.random() * letters.length)];
      dynamicZone.innerHTML = `ğŸ’Œ ${chosen}`;
    });

    // ----- HUG MEMORY (last 5) -----
    document.getElementById('memoryTool').addEventListener('click', function() {
      let memList = JSON.parse(localStorage.getItem('hugMemoryList') || '[]');
      if (memList.length === 0) memList = ['ğŸ«‚ your first hug', 'ğŸ«‚ another warm hug'];
      let html = 'ğŸ“– recent hugs:<br>';
      memList.slice(-4).forEach(m => html += 'ğŸ«‚ ' + m + '<br>');
      dynamicZone.innerHTML = html;
    });

    // ----- BREATHE (visual only, no audio) -----
    let breathActive = false;
    let breathInterval = null;
    document.getElementById('breatheTool').addEventListener('click', function() {
      if (breathActive) {
        clearInterval(breathInterval);
        breathActive = false;
        dynamicZone.innerHTML = 'âœ¨ breathing paused';
        return;
      }
      breathActive = true;
      let phase = 'inhale';
      let counter = 0;
      dynamicZone.innerHTML = `<div style="font-size:2rem; text-align:center;">ğŸ«<br><span style="font-size:1.3rem;" id="breathMsg">inhale... 3s</span></div>`;
      breathInterval = setInterval(() => {
        counter++;
        let msgEl = document.getElementById('breathMsg');
        if (msgEl) {
          if (counter % 6 < 3) msgEl.textContent = 'inhale... 3s';
          else msgEl.textContent = 'exhale... 3s';
        }
        if (counter > 30) { // auto-stop after 30s
          clearInterval(breathInterval);
          breathActive = false;
          dynamicZone.innerHTML = 'ğŸ§˜ breathe complete';
        }
      }, 1000);
    });

    // first message
    setTimeout(() => {
      hugMessage.textContent = 'ğŸ«‚ hold the hug button â€” it counts every second';
    }, 200);
  })();
</script>

</body>
</html>
