<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Teddy Day üß∏</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Neue', 'Arial Rounded MT Bold', cursive;
        }

        body {
            background: linear-gradient(135deg, #ffd6e7 0%, #ffc2d1 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
            transition: background 1.5s ease;
        }

        .night-sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0;
            transition: opacity 2s ease;
            background: linear-gradient(to bottom, #0a0a2a 0%, #1a1a4a 100%);
        }

        .moon {
            position: absolute;
            top: 15%;
            right: 15%;
            width: 60px;
            height: 60px;
            background: #f8f8e6;
            border-radius: 50%;
            box-shadow: 0 0 30px rgba(255, 255, 200, 0.8);
        }

        .container {
            max-width: 900px;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.98);
            border-radius: 30px;
            box-shadow: 0 20px 40px rgba(231, 124, 156, 0.25);
            padding: 30px;
            position: relative;
            overflow: hidden;
            border: 10px solid #ffb6c1;
            z-index: 10;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 12px;
            background: linear-gradient(90deg, #ff9ebb, #ffc2d1, #ff9ebb);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        h1 {
            color: #d45d79;
            margin-bottom: 0;
            font-size: 2.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        .icon-btn {
            background: #ff9ebb;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 158, 187, 0.3);
        }

        .icon-btn:hover {
            transform: scale(1.1);
            background: #ff7b9c;
        }

        .subtitle {
            text-align: center;
            color: #ff7b9c;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-style: italic;
        }

        .teddy-container {
            position: relative;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0 30px;
            background: rgba(255, 245, 250, 0.5);
            border-radius: 20px;
            overflow: hidden;
        }

        .teddy {
            width: 180px;
            height: 200px;
            position: relative;
            transition: all 0.5s ease;
            z-index: 2;
        }

        .teddy-body {
            width: 180px;
            height: 160px;
            background-color: #c57a5f;
            border-radius: 50% 50% 45% 45%;
            position: absolute;
            top: 40px;
            box-shadow: inset 0 -10px 0 rgba(0, 0, 0, 0.1);
        }

        .teddy-head {
            width: 140px;
            height: 130px;
            background-color: #c57a5f;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 20px;
            z-index: 3;
        }

        .ear {
            width: 40px;
            height: 50px;
            background-color: #c57a5f;
            border-radius: 50%;
            position: absolute;
            top: -15px;
        }

        .ear-left {
            left: 15px;
            transform: rotate(-20deg);
        }

        .ear-right {
            right: 15px;
            transform: rotate(20deg);
        }

        .eye {
            width: 25px;
            height: 35px;
            background-color: #3a2c2c;
            border-radius: 50%;
            position: absolute;
            top: 45px;
            transition: all 0.5s ease;
        }

        .eye-left {
            left: 35px;
        }

        .eye-right {
            right: 35px;
        }

        .eye-shine {
            width: 8px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            position: absolute;
            top: 8px;
            left: 5px;
        }

        .nose {
            width: 20px;
            height: 15px;
            background-color: #3a2c2c;
            border-radius: 50%;
            position: absolute;
            top: 75px;
            left: 60px;
        }

        .mouth {
            width: 30px;
            height: 10px;
            border-bottom: 4px solid #3a2c2c;
            border-radius: 0 0 50% 50%;
            position: absolute;
            top: 95px;
            left: 55px;
            transition: all 0.5s ease;
        }

        .mouth.smile {
            border-radius: 0 0 50% 50%;
            border-bottom: 6px solid #3a2c2c;
            height: 15px;
        }

        .mouth.sleep {
            width: 25px;
            border-bottom: 3px solid #3a2c2c;
            border-radius: 50%;
            transform: rotate(90deg);
            top: 100px;
            left: 58px;
        }

        .arm {
            width: 60px;
            height: 40px;
            background-color: #c57a5f;
            border-radius: 50%;
            position: absolute;
            top: 90px;
            z-index: 1;
            transition: transform 0.5s ease;
        }

        .arm-left {
            left: -15px;
            transform: rotate(30deg);
        }

        .arm-right {
            right: -15px;
            transform: rotate(-30deg);
        }

        .arm.hug {
            transform: rotate(0deg) !important;
            top: 70px;
        }

        .leg {
            width: 50px;
            height: 40px;
            background-color: #c57a5f;
            border-radius: 50%;
            position: absolute;
            bottom: 0;
        }

        .leg-left {
            left: 40px;
        }

        .leg-right {
            right: 40px;
        }

        .message-box {
            background-color: #fff9fb;
            border-radius: 20px;
            padding: 20px;
            margin: 20px auto;
            text-align: center;
            font-size: 1.5rem;
            color: #d45d79;
            border: 3px dashed #ffb6c1;
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 700px;
            transition: all 0.5s ease;
            position: relative;
        }

        .message-box::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #ffb6c1;
        }

        .actions-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(135deg, #ff9ebb 0%, #ff7b9c 100%);
            border: none;
            border-radius: 50px;
            padding: 18px 35px;
            font-size: 1.4rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 158, 187, 0.4);
            opacity: 0.7;
            pointer-events: none;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn.active {
            opacity: 1;
            pointer-events: all;
        }

        .action-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 25px rgba(255, 158, 187, 0.6);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .action-btn .counter {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4757;
            color: white;
            font-size: 0.8rem;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .honey {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #ffc107;
            border-radius: 50% 50% 40% 40%;
            z-index: 5;
            opacity: 0;
            pointer-events: none;
        }

        .blanket {
            position: absolute;
            width: 280px;
            height: 120px;
            background: linear-gradient(to bottom, #a8e6cf 0%, #8dd7c0 100%);
            bottom: -120px;
            border-radius: 15px 15px 0 0;
            z-index: 1;
            transition: bottom 1.5s ease;
            box-shadow: 0 -8px 20px rgba(0, 0, 0, 0.15);
            border-top: 5px solid #7ccbb1;
        }

        .blanket-pattern {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(#7ccbb1 2px, transparent 2px);
            background-size: 20px 20px;
            opacity: 0.3;
        }

        .heart {
            position: absolute;
            color: #ff7b9c;
            font-size: 1.5rem;
            opacity: 0;
            z-index: 10;
            pointer-events: none;
        }

        .final-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 214, 231, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
        }

        .final-screen.active {
            opacity: 1;
            pointer-events: all;
        }

        .final-text {
            font-size: 2.8rem;
            color: #d45d79;
            margin-bottom: 30px;
            line-height: 1.4;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .reset-btn {
            background: linear-gradient(135deg, #ff9ebb 0%, #ff7b9c 100%);
            border: none;
            border-radius: 50px;
            padding: 18px 45px;
            font-size: 1.3rem;
            color: white;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 158, 187, 0.4);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .reset-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 25px rgba(255, 158, 187, 0.6);
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            color: #ffd166;
            font-size: 1.2rem;
            opacity: 0;
        }

        .instructions {
            text-align: center;
            color: #ff7b9c;
            font-style: italic;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .progress-container {
            width: 100%;
            max-width: 700px;
            height: 12px;
            background-color: #ffe4ec;
            border-radius: 6px;
            margin: 25px auto;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff9ebb, #ffc2d1, #ff9ebb);
            border-radius: 6px;
            transition: width 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        .memory-album {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 245, 250, 0.98);
            border-radius: 20px;
            padding: 30px;
            z-index: 25;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
        }

        .memory-album.active {
            display: flex;
        }

        .album-title {
            color: #d45d79;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            width: 100%;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .memory-card {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .memory-card:hover {
            transform: translateY(-5px);
        }

        .memory-emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .memory-text {
            color: #d45d79;
            font-size: 0.9rem;
        }

        .close-album {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff9ebb;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #ff9ebb;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.1);
        }

        .personalized-area {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 245, 250, 0.7);
            border-radius: 15px;
            border: 2px dashed #ffb6c1;
            text-align: center;
        }

        .personalized-input {
            padding: 10px 15px;
            border: 2px solid #ffb6c1;
            border-radius: 10px;
            font-size: 1rem;
            width: 200px;
            margin-right: 10px;
        }

        .personalized-btn {
            background: #ff9ebb;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .actions-container {
                gap: 15px;
            }
            
            .action-btn {
                padding: 15px 25px;
                font-size: 1.2rem;
            }
            
            .teddy-container {
                height: 280px;
            }
            
            .final-text {
                font-size: 2.2rem;
            }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes honeyDrip {
            0% { opacity: 0; transform: translateY(-50px) scale(0.5); }
            20% { opacity: 1; transform: translateY(0) scale(1); }
            80% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(20px) scale(0.5); }
        }

        @keyframes heartFloat {
            0% { opacity: 0; transform: translateY(0) scale(0); }
            20% { opacity: 1; transform: translateY(-20px) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(0.5); }
        }

        @keyframes starTwinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1); }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes blink {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.1); }
        }

        @keyframes nightIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Night sky for tuck-in phase -->
    <div class="night-sky" id="nightSky">
        <div class="moon"></div>
    </div>
    
    <!-- Sound toggle -->
    <button class="sound-toggle" id="soundToggle">
        <i class="fas fa-volume-up"></i>
    </button>
    
    <div class="container">
        <div class="header">
            <h1>üß∏ Happy Teddy Day üß∏</h1>
            <div class="controls">
                <button class="icon-btn" id="musicBtn" title="Toggle Music">
                    <i class="fas fa-music"></i>
                </button>
                <button class="icon-btn" id="albumBtn" title="Memory Album">
                    <i class="fas fa-book"></i>
                </button>
                <button class="icon-btn" id="helpBtn" title="Instructions">
                    <i class="fas fa-question"></i>
                </button>
            </div>
        </div>
        
        <div class="subtitle">A cozy interactive experience for my favorite person</div>
        
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="message-box" id="messageBox">
            This teddy's had a long day...
        </div>
        
        <div class="teddy-container">
            <div class="stars" id="starsContainer"></div>
            
            <div class="teddy" id="teddy">
                <div class="teddy-body"></div>
                <div class="teddy-head">
                    <div class="ear ear-left"></div>
                    <div class="ear ear-right"></div>
                    <div class="eye eye-left">
                        <div class="eye-shine"></div>
                    </div>
                    <div class="eye eye-right">
                        <div class="eye-shine"></div>
                    </div>
                    <div class="nose"></div>
                    <div class="mouth" id="teddyMouth"></div>
                </div>
                <div class="arm arm-left" id="leftArm"></div>
                <div class="arm arm-right" id="rightArm"></div>
                <div class="leg leg-left"></div>
                <div class="leg leg-right"></div>
            </div>
            
            <div class="blanket" id="blanket">
                <div class="blanket-pattern"></div>
            </div>
        </div>
        
        <div class="actions-container">
            <button class="action-btn active" id="feedBtn">
                <span>üçØ</span> Feed
                <div class="counter" id="feedCounter">0</div>
            </button>
            <button class="action-btn" id="hugBtn">
                <span>ü´Ç</span> Hug
                <div class="counter" id="hugCounter">0</div>
            </button>
            <button class="action-btn" id="tuckBtn">
                <span>üò¥</span> Tuck In
                <div class="counter" id="tuckCounter">0</div>
            </button>
        </div>
        
        <div class="personalized-area">
            <p style="margin-bottom: 10px; color: #d45d79;">Add your name to personalize the experience:</p>
            <input type="text" class="personalized-input" id="nameInput" placeholder="Your name" maxlength="20">
            <button class="personalized-btn" id="nameBtn">Update</button>
        </div>
        
        <div class="instructions">
            Take care of the teddy by clicking actions in order ‚Ä¢ Each action can be repeated
        </div>
        
        <!-- Memory Album -->
        <div class="memory-album" id="memoryAlbum">
            <h2 class="album-title">Our Teddy Memories</h2>
            <div class="memory-grid" id="memoryGrid">
                <!-- Memories will be added here dynamically -->
            </div>
            <button class="close-album" id="closeAlbum">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Final Screen -->
        <div class="final-screen" id="finalScreen">
            <div class="final-text" id="finalText"></div>
            <button class="reset-btn" id="resetBtn">
                <i class="fas fa-redo"></i> Care for Teddy Again
            </button>
        </div>
    </div>

    <!-- Audio elements -->
    <audio id="bgMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-carefree-joy-1156.mp3" type="audio/mpeg">
    </audio>
    <audio id="feedSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-cute-eating-sounds-2000.mp3" type="audio/mpeg">
    </audio>
    <audio id="hugSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-heartbeat-love-880.mp3" type="audio/mpeg">
    </audio>
    <audio id="tuckSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-soft-sleep-sounds-1007.mp3" type="audio/mpeg">
    </audio>
    <audio id="clickSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="unlockSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" type="audio/mpeg">
    </audio>

    <script>
        // DOM Elements
        const teddy = document.getElementById('teddy');
        const messageBox = document.getElementById('messageBox');
        const feedBtn = document.getElementById('feedBtn');
        const hugBtn = document.getElementById('hugBtn');
        const tuckBtn = document.getElementById('tuckBtn');
        const finalScreen = document.getElementById('finalScreen');
        const finalText = document.getElementById('finalText');
        const resetBtn = document.getElementById('resetBtn');
        const progressBar = document.getElementById('progressBar');
        const starsContainer = document.getElementById('starsContainer');
        const blanket = document.getElementById('blanket');
        const nightSky = document.getElementById('nightSky');
        const teddyMouth = document.getElementById('teddyMouth');
        const leftArm = document.getElementById('leftArm');
        const rightArm = document.getElementById('rightArm');
        const soundToggle = document.getElementById('soundToggle');
        const musicBtn = document.getElementById('musicBtn');
        const albumBtn = document.getElementById('albumBtn');
        const helpBtn = document.getElementById('helpBtn');
        const memoryAlbum = document.getElementById('memoryAlbum');
        const memoryGrid = document.getElementById('memoryGrid');
        const closeAlbum = document.getElementById('closeAlbum');
        const nameInput = document.getElementById('nameInput');
        const nameBtn = document.getElementById('nameBtn');
        
        // Audio elements
        const bgMusic = document.getElementById('bgMusic');
        const feedSound = document.getElementById('feedSound');
        const hugSound = document.getElementById('hugSound');
        const tuckSound = document.getElementById('tuckSound');
        const clickSound = document.getElementById('clickSound');
        const unlockSound = document.getElementById('unlockSound');
        
        // Counters
        const feedCounter = document.getElementById('feedCounter');
        const hugCounter = document.getElementById('hugCounter');
        const tuckCounter = document.getElementById('tuckCounter');
        
        // Game state
        let currentState = 0;
        let feedCount = 0;
        let hugCount = 0;
        let tuckCount = 0;
        let playerName = "My Love";
        let memories = [];
        let soundEnabled = true;
        let musicEnabled = false;
        
        const states = [
            { 
                message: "This teddy's had a long day...", 
                nextAction: "feed",
                progress: 0
            },
            { 
                message: "That helped... thank you.", 
                nextAction: "hug",
                progress: 25
            },
            { 
                message: "I needed that.", 
                nextAction: "tuck",
                progress: 50
            },
            { 
                message: "I feel safe now.", 
                nextAction: "complete",
                progress: 75
            }
        ];
        
        // Final message
        const finalMessage = "You're my comfort too, {name}.<br>Happy Teddy Day üß∏‚ù§Ô∏è";
        
        // Memory templates
        const memoryTemplates = [
            { emoji: "üçØ", text: "Fed the teddy" },
            { emoji: "ü´Ç", text: "Gave a warm hug" },
            { emoji: "üò¥", text: "Tucked in safely" },
            { emoji: "üß∏", text: "Made teddy happy" },
            { emoji: "üíñ", text: "Showed love" },
            { emoji: "üåü", text: "Brightened the day" }
        ];
        
        // Initialize
        function init() {
            // Set up event listeners
            feedBtn.addEventListener('click', feedTeddy);
            hugBtn.addEventListener('click', hugTeddy);
            tuckBtn.addEventListener('click', tuckTeddy);
            resetBtn.addEventListener('click', resetExperience);
            soundToggle.addEventListener('click', toggleSound);
            musicBtn.addEventListener('click', toggleMusic);
            albumBtn.addEventListener('click', showAlbum);
            helpBtn.addEventListener('click', showInstructions);
            closeAlbum.addEventListener('click', hideAlbum);
            nameBtn.addEventListener('click', updateName);
            
            // Try to autoplay background music (muted by default)
            bgMusic.muted = true;
            bgMusic.volume = 0.3;
            
            // Add floating animation to teddy
            teddy.style.animation = "float 4s ease-in-out infinite";
            
            // Create some twinkling stars in the background
            createStars();
            
            // Load saved data if available
            loadSavedData();
            
            // Update counters
            updateCounters();
            
            // Add eye blinking animation
            setInterval(blinkEyes, 3000);
        }
        
        // Create twinkling stars
        function createStars() {
            // Clear existing stars
            starsContainer.innerHTML = '';
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.innerHTML = '‚ú¶';
                
                // Random position
                const left = Math.random() * 100;
                const top = Math.random() * 100;
                star.style.left = `${left}%`;
                star.style.top = `${top}%`;
                
                // Random animation delay
                const delay = Math.random() * 5;
                const duration = 2 + Math.random() * 3;
                star.style.animation = `starTwinkle ${duration}s ease-in-out ${delay}s infinite`;
                
                starsContainer.appendChild(star);
            }
        }
        
        // Eye blinking animation
        function blinkEyes() {
            const eyes = document.querySelectorAll('.eye');
            eyes.forEach(eye => {
                eye.style.animation = 'blink 0.3s ease';
                setTimeout(() => {
                    eye.style.animation = '';
                }, 300);
            });
        }
        
        // Feed action
        function feedTeddy() {
            if (currentState < 1) return;
            
            playSound(clickSound);
            playSound(feedSound);
            
            // Animate honey
            createHoneyAnimation();
            
            // Change teddy appearance
            teddy.style.transform = "scale(1.1)";
            teddyMouth.classList.add('smile');
            
            setTimeout(() => {
                teddy.style.transform = "scale(1.05)";
            }, 300);
            
            // Update counter
            feedCount++;
            updateCounters();
            
            // Update message
            updateState();
            
            // Enable next action if needed
            if (currentState === 1) {
                setTimeout(() => {
                    hugBtn.classList.add('active');
                    playSound(unlockSound);
                    addMemory("üçØ", "You fed the hungry teddy!");
                }, 800);
            }
            
            // Create hearts
            createHearts(3);
            
            // Save progress
            saveProgress();
        }
        
        // Hug action
        function hugTeddy() {
            if (currentState < 2) return;
            
            playSound(clickSound);
            playSound(hugSound);
            
            // Animate hug (teddy grows and arms move)
            teddy.style.transform = "scale(1.15)";
            leftArm.classList.add('hug');
            rightArm.classList.add('hug');
            document.body.style.background = "linear-gradient(135deg, #ffc2d1 0%, #ff9ebb 100%)";
            
            // Update counter
            hugCount++;
            updateCounters();
            
            // Update message
            updateState();
            
            // Enable next action if needed
            if (currentState === 2) {
                setTimeout(() => {
                    tuckBtn.classList.add('active');
                    playSound(unlockSound);
                    addMemory("ü´Ç", "You gave the teddy a warm hug!");
                }, 800);
            }
            
            // Return to normal after a moment
            setTimeout(() => {
                leftArm.classList.remove('hug');
                rightArm.classList.remove('hug');
                setTimeout(() => {
                    document.body.style.background = "linear-gradient(135deg, #ffd6e7 0%, #ffc2d1 100%)";
                }, 1000);
            }, 1500);
            
            // Create hearts
            createHearts(5);
            
            // Save progress
            saveProgress();
        }
        
        // Tuck in action
        function tuckTeddy() {
            if (currentState < 3) return;
            
            playSound(clickSound);
            playSound(tuckSound);
            
            // Animate blanket
            blanket.style.bottom = "0px";
            
            // Show night sky
            nightSky.style.opacity = "1";
            
            // Close eyes (reduce opacity) and change mouth
            const eyes = document.querySelectorAll('.eye');
            eyes.forEach(eye => {
                eye.style.opacity = "0.3";
            });
            
            teddyMouth.classList.remove('smile');
            teddyMouth.classList.add('sleep');
            
            // Update counter
            tuckCount++;
            updateCounters();
            
            // Update message
            updateState();
            
            // Show final screen after delay
            setTimeout(() => {
                showFinalScreen();
                addMemory("üò¥", "You tucked the teddy in for the night!");
            }, 2000);
            
            // Create hearts
            createHearts(8);
            
            // Save progress
            saveProgress();
        }
        
        // Create honey animation
        function createHoneyAnimation() {
            const honey = document.createElement('div');
            honey.classList.add('honey');
            
            // Position near teddy's mouth
            const teddyRect = teddy.getBoundingClientRect();
            honey.style.left = `${teddyRect.left + teddyRect.width/2 - 15}px`;
            honey.style.top = `${teddyRect.top + 100}px`;
            
            document.body.appendChild(honey);
            
            // Animate honey
            honey.style.animation = "honeyDrip 1.5s ease forwards";
            
            // Remove after animation
            setTimeout(() => {
                honey.remove();
            }, 1500);
        }
        
        // Create floating hearts
        function createHearts(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.classList.add('heart');
                    heart.innerHTML = Math.random() > 0.5 ? '‚ù§Ô∏è' : 'üíñ';
                    
                    // Random position near teddy
                    const teddyRect = teddy.getBoundingClientRect();
                    const left = teddyRect.left + Math.random() * 100 - 50;
                    const top = teddyRect.top + Math.random() * 50;
                    
                    heart.style.left = `${left}px`;
                    heart.style.top = `${top}px`;
                    
                    // Random size
                    const size = 1 + Math.random() * 0.5;
                    heart.style.fontSize = `${size}rem`;
                    
                    document.body.appendChild(heart);
                    
                    // Animate heart
                    heart.style.animation = `heartFloat ${1 + Math.random()}s ease forwards`;
                    
                    // Remove after animation
                    setTimeout(() => {
                        heart.remove();
                    }, 2000);
                }, i * 200);
            }
        }
        
        // Update game state
        function updateState() {
            if (currentState < states.length - 1) {
                currentState++;
                
                // Update message
                messageBox.textContent = states[currentState].message;
                messageBox.style.animation = "none";
                setTimeout(() => {
                    messageBox.style.animation = "pulse 0.5s ease";
                }, 10);
                
                // Update progress bar
                progressBar.style.width = `${states[currentState].progress}%`;
            }
        }
        
        // Update counters display
        function updateCounters() {
            feedCounter.textContent = feedCount;
            hugCounter.textContent = hugCount;
            tuckCounter.textContent = tuckCount;
        }
        
        // Show final screen
        function showFinalScreen() {
            const personalizedMessage = finalMessage.replace("{name}", playerName);
            finalText.innerHTML = personalizedMessage;
            finalScreen.classList.add('active');
            
            // Add some final hearts
            createHearts(12);
            
            // Add completion memory
            addMemory("üéâ", "You completed caring for the teddy!");
        }
        
        // Toggle sound effects
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const icon = soundToggle.querySelector('i');
            
            if (soundEnabled) {
                icon.className = "fas fa-volume-up";
                soundToggle.style.background = "#ff9ebb";
            } else {
                icon.className = "fas fa-volume-mute";
                soundToggle.style.background = "#aaa";
            }
        }
        
        // Toggle background music
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            const icon = musicBtn.querySelector('i');
            
            if (musicEnabled) {
                bgMusic.muted = false;
                bgMusic.play().catch(e => console.log("Autoplay prevented"));
                icon.style.color = "#ff4757";
                musicBtn.style.transform = "scale(1.1)";
                setTimeout(() => {
                    musicBtn.style.transform = "scale(1)";
                }, 200);
            } else {
                bgMusic.pause();
                icon.style.color = "white";
            }
        }
        
        // Play sound if enabled
        function playSound(soundElement) {
            if (!soundEnabled) return;
            
            soundElement.currentTime = 0;
            soundElement.play().catch(e => console.log("Sound play prevented"));
        }
        
        // Show memory album
        function showAlbum() {
            playSound(clickSound);
            memoryAlbum.classList.add('active');
            renderMemories();
        }
        
        // Hide memory album
        function hideAlbum() {
            playSound(clickSound);
            memoryAlbum.classList.remove('active');
        }
        
        // Add a memory to the album
        function addMemory(emoji, text) {
            const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const memory = {
                emoji,
                text: `${text} (${timestamp})`,
                date: new Date().toLocaleDateString()
            };
            
            memories.push(memory);
            
            // Limit to 12 memories
            if (memories.length > 12) {
                memories.shift();
            }
            
            // Save memories
            saveProgress();
        }
        
        // Render memories in the album
        function renderMemories() {
            memoryGrid.innerHTML = '';
            
            if (memories.length === 0) {
                // Add default memories based on actions
                const defaultMemories = [
                    { emoji: "üçØ", text: "Feed the teddy to unlock memories!" },
                    { emoji: "ü´Ç", text: "Give the teddy a warm hug" },
                    { emoji: "üò¥", text: "Tuck the teddy in for the night" },
                    { emoji: "üß∏", text: "Make the teddy feel loved" },
                    { emoji: "üíù", text: "Create sweet memories together" },
                    { emoji: "üåü", text: "Your caring moments will appear here" }
                ];
                
                defaultMemories.forEach(memory => {
                    const memoryCard = document.createElement('div');
                    memoryCard.className = 'memory-card';
                    memoryCard.innerHTML = `
                        <div class="memory-emoji">${memory.emoji}</div>
                        <div class="memory-text">${memory.text}</div>
                    `;
                    memoryGrid.appendChild(memoryCard);
                });
            } else {
                memories.forEach(memory => {
                    const memoryCard = document.createElement('div');
                    memoryCard.className = 'memory-card';
                    memoryCard.innerHTML = `
                        <div class="memory-emoji">${memory.emoji}</div>
                        <div class="memory-text">${memory.text}</div>
                    `;
                    memoryGrid.appendChild(memoryCard);
                });
            }
        }
        
        // Show instructions
        function showInstructions() {
            playSound(clickSound);
            alert("üíå Teddy Day Instructions üíå\n\n1. Click actions in order: Feed ‚Üí Hug ‚Üí Tuck In\n2. Each action can be repeated for more love\n3. Unlock all actions to complete the experience\n4. Check the Memory Album for your caring moments\n5. Add your name to personalize the message\n\nEnjoy this cozy moment! üß∏‚ù§Ô∏è");
        }
        
        // Update player name
        function updateName() {
            playSound(clickSound);
            const newName = nameInput.value.trim();
            if (newName) {
                playerName = newName;
                nameInput.value = "";
                nameInput.placeholder = playerName;
                
                // Show confirmation
                messageBox.textContent = `Hello, ${playerName}! The teddy is happy to see you.`;
                messageBox.style.animation = "none";
                setTimeout(() => {
                    messageBox.style.animation = "pulse 0.5s ease";
                }, 10);
                
                // Save name
                saveProgress();
            }
        }
        
        // Save progress to localStorage
        function saveProgress() {
            const progress = {
                currentState,
                feedCount,
                hugCount,
                tuckCount,
                playerName,
                memories,
                lastPlayed: new Date().toISOString()
            };
            
            localStorage.setItem('teddyDayProgress', JSON.stringify(progress));
        }
        
        // Load progress from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('teddyDayProgress');
            if (saved) {
                try {
                    const progress = JSON.parse(saved);
                    
                    currentState = progress.currentState || 0;
                    feedCount = progress.feedCount || 0;
                    hugCount = progress.hugCount || 0;
                    tuckCount = progress.tuckCount || 0;
                    playerName = progress.playerName || "My Love";
                    memories = progress.memories || [];
                    
                    // Update UI based on loaded state
                    nameInput.placeholder = playerName;
                    
                    // Enable buttons based on state
                    if (currentState >= 1) {
                        feedBtn.classList.add('active');
                        hugBtn.classList.add('active');
                    }
                    
                    if (currentState >= 2) {
                        tuckBtn.classList.add('active');
                    }
                    
                    // Update progress bar
                    progressBar.style.width = `${states[currentState]?.progress || 0}%`;
                    
                    // Update message
                    messageBox.textContent = states[currentState]?.message || states[0].message;
                    
                    // If completed, show final screen
                    if (currentState >= states.length - 1) {
                        setTimeout(() => {
                            showFinalScreen();
                        }, 500);
                    }
                    
                } catch (e) {
                    console.log("Could not load saved progress");
                }
            }
        }
        
        // Reset experience
        function resetExperience() {
            playSound(clickSound);
            
            // Reset state
            currentState = 0;
            feedCount = 0;
            hugCount = 0;
            tuckCount = 0;
            
            // Reset UI
            messageBox.textContent = states[0].message;
            teddy.style.transform = "scale(1)";
            blanket.style.bottom = "-120px";
            nightSky.style.opacity = "0";
            
            // Reset facial features
            teddyMouth.className = "mouth";
            
            // Reset eyes
            const eyes = document.querySelectorAll('.eye');
            eyes.forEach(eye => {
                eye.style.opacity = "1";
            });
            
            // Reset arms
            leftArm.className = "arm arm-left";
            rightArm.className = "arm arm-right";
            
            // Reset actions
            hugBtn.classList.remove('active');
            tuckBtn.classList.remove('active');
            feedBtn.classList.add('active');
            
            // Reset progress bar
            progressBar.style.width = "0%";
            
            // Hide final screen
            finalScreen.classList.remove('active');
            
            // Reset background
            document.body.style.background = "linear-gradient(135deg, #ffd6e7 0%, #ffc2d1 100%)";
            
            // Create more stars
            createStars();
            
            // Add reset memory
            addMemory("üîÑ", "You started caring for the teddy again!");
            
            // Update counters
            updateCounters();
            
            // Save reset state
            saveProgress();
        }
        
        // Initialize the experience
        window.onload = init;
    </script>
</body>
</html>
