<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chocolate Photo Booth | Capture Sweet Moments</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --chocolate-dark: #4a2c2a;
            --chocolate-medium: #7b3f00;
            --chocolate-light: #d2691e;
            --chocolate-cream: #f5e8da;
            --chocolate-milk: #8b5a2b;
            --chocolate-caramel: #d35400;
            --gold: #ffd700;
            --gold-light: #fff9c4;
            --rose: #ff6b8b;
            --ribbon-red: #ff4757;
            --ribbon-gold: #ffd700;
            --ribbon-brown: #8b4513;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium), var(--chocolate-light));
            color: var(--chocolate-cream);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 139, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 40% 40%, rgba(139, 69, 19, 0.15) 0%, transparent 30%);
            z-index: -1;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
        }

        .header h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: var(--gold-light);
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: gentleGlow 3s infinite alternate;
        }

        .header p {
            font-size: 1.4rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        /* Photo Booth Section */
        .photo-booth {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 3px solid var(--gold);
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .booth-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin-bottom: 30px;
            color: var(--gold-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        /* Camera Container */
        .camera-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 40px;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 20px;
            border: 3px solid var(--chocolate-light);
        }

        .camera-view {
            width: 100%;
            height: 400px;
            background: #333;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border: 5px solid var(--chocolate-dark);
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror effect */
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .overlay-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 90%;
            border: 15px solid transparent;
            background: 
                linear-gradient(var(--chocolate-dark), var(--chocolate-dark)) padding-box,
                repeating-linear-gradient(45deg, var(--gold) 0, var(--gold) 10px, var(--chocolate-light) 10px, var(--chocolate-light) 20px) border-box;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            color: var(--gold);
            z-index: 3;
        }

        /* Photo Strip Container */
        .photo-strip-container {
            width: 100%;
            max-width: 900px;
            margin: 40px auto;
            background: var(--chocolate-cream);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            position: relative;
            border: 5px solid var(--chocolate-dark);
            transform: rotate(-1deg);
        }

        /* Chocolate Ribbons */
        .ribbon {
            position: absolute;
            background: var(--ribbon-red);
            z-index: 2;
        }

        .ribbon-1 {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: linear-gradient(90deg, var(--ribbon-red), var(--ribbon-gold));
            border-radius: 15px 15px 0 0;
        }

        .ribbon-2 {
            top: 50%;
            left: -20px;
            transform: translateY(-50%) rotate(90deg);
            width: 120px;
            height: 25px;
            background: linear-gradient(90deg, var(--ribbon-brown), var(--ribbon-gold));
            border-radius: 12px;
        }

        .ribbon-3 {
            top: 50%;
            right: -20px;
            transform: translateY(-50%) rotate(90deg);
            width: 120px;
            height: 25px;
            background: linear-gradient(90deg, var(--ribbon-gold), var(--ribbon-brown));
            border-radius: 12px;
        }

        .ribbon-4 {
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: linear-gradient(90deg, var(--ribbon-gold), var(--ribbon-red));
            border-radius: 0 0 15px 15px;
        }

        /* Photo Strip */
        .photo-strip {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium));
            border-radius: 15px;
            position: relative;
            z-index: 1;
        }

        .photo-slot {
            width: 200px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 5px solid var(--chocolate-light);
            transition: all 0.3s ease;
        }

        .photo-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .photo-slot.empty {
            background: repeating-linear-gradient(45deg, 
                rgba(139, 69, 19, 0.2), 
                rgba(139, 69, 19, 0.2) 10px, 
                rgba(210, 105, 30, 0.2) 10px, 
                rgba(210, 105, 30, 0.2) 20px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--chocolate-light);
        }

        .captured-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slot-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--gold);
            color: var(--chocolate-dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid var(--chocolate-dark);
        }

        /* Chocolate Decorations */
        .chocolate-decoration {
            position: absolute;
            font-size: 2rem;
            z-index: 2;
            pointer-events: none;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .control-btn {
            padding: 18px 35px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            justify-content: center;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, var(--rose), var(--gold));
            color: white;
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, var(--chocolate-light), var(--chocolate-caramel));
            color: white;
        }

        .control-btn.tertiary {
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium));
            color: var(--chocolate-cream);
            border: 2px solid var(--gold);
        }

        .control-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Flash Effect */
        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        /* Instructions */
        .instructions {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            border-left: 5px solid var(--gold);
        }

        .instructions h3 {
            color: var(--gold-light);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Gallery */
        .gallery-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 30px;
            padding: 40px;
            margin-top: 40px;
            border: 3px solid var(--chocolate-light);
            backdrop-filter: blur(10px);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 3px solid var(--chocolate-light);
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .gallery-photo {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .gallery-info {
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        @keyframes gentleGlow {
            0% { text-shadow: 0 4px 8px rgba(255, 215, 0, 0.3); }
            100% { text-shadow: 0 4px 20px rgba(255, 215, 0, 0.7), 0 0 30px rgba(255, 107, 139, 0.5); }
        }

        @keyframes countdown {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0; }
        }

        @keyframes captureFlash {
            0% { opacity: 0; }
            50% { opacity: 0.9; }
            100% { opacity: 0; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .photo-strip {
                flex-direction: column;
                gap: 30px;
            }
            
            .photo-slot {
                width: 250px;
                height: 300px;
            }
            
            .booth-title {
                font-size: 2.8rem;
            }
            
            .camera-view {
                height: 300px;
            }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .photo-booth, .gallery-section {
                padding: 20px;
            }
            
            .control-btn {
                min-width: 100%;
                padding: 15px 25px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Flash Effect -->
    <div class="flash-effect" id="flash-effect"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-camera"></i> Chocolate Photo Booth <i class="fas fa-camera"></i></h1>
            <p>Capture 3 sweet moments in our chocolate-themed photo strip! üì∏üç´</p>
        </header>

        <!-- Photo Booth Section -->
        <section class="photo-booth">
            <h2 class="booth-title">
                <i class="fas fa-crown"></i> Capture Your Sweet Moments <i class="fas fa-crown"></i>
            </h2>
            
            <!-- Camera View -->
            <div class="camera-container">
                <div class="camera-view">
                    <video id="video" autoplay playsinline></video>
                    <div class="camera-overlay">
                        <div class="overlay-frame"></div>
                    </div>
                    <div class="countdown-overlay" id="countdown-overlay">3</div>
                </div>
                
                <div class="controls">
                    <button class="control-btn primary" id="start-camera">
                        <i class="fas fa-video"></i> Start Camera
                    </button>
                    <button class="control-btn secondary" id="capture-btn" disabled>
                        <i class="fas fa-camera"></i> Take Photo
                    </button>
                    <button class="control-btn tertiary" id="reset-btn">
                        <i class="fas fa-redo"></i> Reset Strip
                    </button>
                </div>
            </div>
            
            <!-- Photo Strip -->
            <div class="photo-strip-container">
                <!-- Chocolate Ribbons -->
                <div class="ribbon ribbon-1"></div>
                <div class="ribbon ribbon-2"></div>
                <div class="ribbon ribbon-3"></div>
                <div class="ribbon ribbon-4"></div>
                
                <!-- Chocolate Decorations -->
                <div class="chocolate-decoration" style="top: -30px; left: 10%;">üç´</div>
                <div class="chocolate-decoration" style="top: -30px; right: 10%;">üç¨</div>
                <div class="chocolate-decoration" style="bottom: -30px; left: 15%;">üç™</div>
                <div class="chocolate-decoration" style="bottom: -30px; right: 15%;">üéÇ</div>
                
                <div class="photo-strip" id="photo-strip">
                    <!-- Photo Slot 1 -->
                    <div class="photo-slot empty" id="slot-1">
                        <div class="slot-number">1</div>
                        <div>Click "Take Photo"!</div>
                    </div>
                    
                    <!-- Photo Slot 2 -->
                    <div class="photo-slot empty" id="slot-2">
                        <div class="slot-number">2</div>
                        <div>Ready for photo 2!</div>
                    </div>
                    
                    <!-- Photo Slot 3 -->
                    <div class="photo-slot empty" id="slot-3">
                        <div class="slot-number">3</div>
                        <div>Final photo spot!</div>
                    </div>
                </div>
            </div>
            
            <!-- Instructions -->
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> How to Use:</h3>
                <p>1. Click "Start Camera" to begin üìπ</p>
                <p>2. Position yourself in the frame üé¨</p>
                <p>3. Click "Take Photo" - countdown from 3! ‚è±Ô∏è</p>
                <p>4. Take 3 photos to complete the strip! üì∏üì∏üì∏</p>
                <p>5. Download your chocolate photo strip! üíæ</p>
            </div>
            
            <div class="controls" style="margin-top: 40px;">
                <button class="control-btn primary" id="download-btn" disabled>
                    <i class="fas fa-download"></i> Download Photo Strip
                </button>
                <button class="control-btn secondary" id="share-btn">
                    <i class="fas fa-share-alt"></i> Share on Chat
                </button>
            </div>
        </section>
        
        <!-- Gallery Section -->
        <section class="gallery-section" id="gallery-section" style="display: none;">
            <h2 class="booth-title">
                <i class="fas fa-images"></i> Your Chocolate Photo Gallery <i class="fas fa-images"></i>
            </h2>
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be added here -->
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State variables
            let stream = null;
            let capturedPhotos = [null, null, null];
            let currentSlot = 0;
            let isCapturing = false;
            let photoGallery = [];
            
            // DOM Elements
            const video = document.getElementById('video');
            const startCameraBtn = document.getElementById('start-camera');
            const captureBtn = document.getElementById('capture-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');
            const shareBtn = document.getElementById('share-btn');
            const countdownOverlay = document.getElementById('countdown-overlay');
            const flashEffect = document.getElementById('flash-effect');
            const photoStrip = document.getElementById('photo-strip');
            const gallerySection = document.getElementById('gallery-section');
            const galleryGrid = document.getElementById('gallery-grid');
            
            // Photo slots
            const photoSlots = [
                document.getElementById('slot-1'),
                document.getElementById('slot-2'),
                document.getElementById('slot-3')
            ];
            
            // Initialize
            function initialize() {
                setupEventListeners();
                createChocolateDecorations();
                updateUI();
            }
            
            // Create floating chocolate decorations
            function createChocolateDecorations() {
                const decorations = ['üç´', 'üç¨', 'üç™', 'üéÇ', 'üßÅ', 'üç©', 'üç∞', 'üíù'];
                const container = document.querySelector('.photo-strip-container');
                
                for (let i = 0; i < 8; i++) {
                    const decor = document.createElement('div');
                    decor.className = 'chocolate-decoration';
                    decor.textContent = decorations[Math.floor(Math.random() * decorations.length)];
                    decor.style.left = Math.random() * 100 + '%';
                    decor.style.top = Math.random() * 100 + '%';
                    decor.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    decor.style.opacity = Math.random() * 0.7 + 0.3;
                    decor.style.animation = `float ${Math.random() * 5 + 5}s infinite ease-in-out`;
                    decor.style.animationDelay = Math.random() * 2 + 's';
                    
                    container.appendChild(decor);
                }
            }
            
            // Setup event listeners
            function setupEventListeners() {
                // Start camera
                startCameraBtn.addEventListener('click', startCamera);
                
                // Capture photo
                captureBtn.addEventListener('click', capturePhoto);
                
                // Reset strip
                resetBtn.addEventListener('click', resetPhotoStrip);
                
                // Download strip
                downloadBtn.addEventListener('click', downloadPhotoStrip);
                
                // Share on chat
                shareBtn.addEventListener('click', shareToChat);
            }
            
            // Start camera
            async function startCamera() {
                try {
                    if (stream) {
                        // Stop existing stream
                        stream.getTracks().forEach(track => track.stop());
                        stream = null;
                        video.srcObject = null;
                        startCameraBtn.innerHTML = '<i class="fas fa-video"></i> Start Camera';
                        captureBtn.disabled = true;
                        updateUI();
                        return;
                    }
                    
                    // Request camera access
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false 
                    });
                    
                    // Set video source
                    video.srcObject = stream;
                    startCameraBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Camera';
                    captureBtn.disabled = false;
                    
                    // Camera started message
                    showMessage("Camera started! Get ready to smile! üòä", "success");
                    
                } catch (error) {
                    console.error('Camera error:', error);
                    showMessage("Couldn't access camera. Using demo mode! üì∏", "warning");
                    
                    // Fallback: Use placeholder
                    video.srcObject = null;
                    video.poster = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%234a2c2a'/%3E%3Ctext x='50%25' y='50%25' font-family='Arial' font-size='60' fill='%23ffd700' text-anchor='middle' dy='.3em'%3ESmile! üòä%3C/text%3E%3C/svg%3E";
                    captureBtn.disabled = false;
                    startCameraBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Demo Mode';
                }
                
                updateUI();
            }
            
            // Capture photo with countdown
            async function capturePhoto() {
                if (isCapturing || currentSlot >= 3) return;
                
                isCapturing = true;
                captureBtn.disabled = true;
                
                // Countdown from 3
                countdownOverlay.style.display = 'flex';
                
                for (let i = 3; i > 0; i--) {
                    countdownOverlay.textContent = i;
                    countdownOverlay.style.animation = 'countdown 1s';
                    await sleep(1000);
                }
                
                // Hide countdown
                countdownOverlay.style.display = 'none';
                
                // Flash effect
                flashEffect.style.animation = 'captureFlash 0.5s';
                
                // Create canvas for photo
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                canvas.width = video.videoWidth || 800;
                canvas.height = video.videoHeight || 600;
                
                // Draw video frame (mirrored)
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
                ctx.restore();
                
                // Add chocolate frame overlay
                addChocolateFrame(ctx, canvas);
                
                // Get data URL
                const dataUrl = canvas.toDataURL('image/png');
                
                // Store photo
                capturedPhotos[currentSlot] = dataUrl;
                
                // Update photo slot
                updatePhotoSlot(currentSlot, dataUrl);
                
                // Move to next slot
                currentSlot++;
                
                // Update UI
                updateUI();
                
                // Show success message
                showMessage(`Photo ${currentSlot}/3 captured! üéâ`, "success");
                
                // Shake animation for photo strip
                photoStrip.parentElement.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    photoStrip.parentElement.style.animation = '';
                }, 500);
                
                isCapturing = false;
                captureBtn.disabled = false;
                
                // Remove flash effect
                setTimeout(() => {
                    flashEffect.style.animation = '';
                }, 500);
            }
            
            // Add chocolate frame to photo
            function addChocolateFrame(ctx, canvas) {
                // Draw chocolate border
                ctx.save();
                
                // Outer chocolate border
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 20;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                
                // Inner gold border
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 10;
                ctx.strokeRect(25, 25, canvas.width - 50, canvas.height - 50);
                
                // Chocolate corner decorations
                const corners = [
                    [30, 30],
                    [canvas.width - 30, 30],
                    [30, canvas.height - 30],
                    [canvas.width - 30, canvas.height - 30]
                ];
                
                corners.forEach(([x, y]) => {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#8B4513';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('üç´', x, y);
                });
                
                // Chocolate-themed text at bottom
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 30px "Dancing Script", cursive';
                ctx.textAlign = 'center';
                ctx.fillText('Sweet Memory üç´', canvas.width / 2, canvas.height - 40);
                
                // Slot number
                ctx.fillStyle = '#8B4513';
                ctx.font = 'bold 40px Arial';
                ctx.fillText(`#${currentSlot + 1}`, canvas.width / 2, 60);
                
                ctx.restore();
            }
            
            // Update photo slot with captured photo
            function updatePhotoSlot(slotIndex, dataUrl) {
                const slot = photoSlots[slotIndex];
                slot.classList.remove('empty');
                slot.innerHTML = `
                    <div class="slot-number">${slotIndex + 1}</div>
                    <img class="captured-photo" src="${dataUrl}" alt="Captured Photo ${slotIndex + 1}">
                `;
            }
            
            // Reset photo strip
            function resetPhotoStrip() {
                if (confirm("Reset all photos and start over?")) {
                    capturedPhotos = [null, null, null];
                    currentSlot = 0;
                    
                    // Reset slots
                    photoSlots.forEach((slot, index) => {
                        slot.classList.add('empty');
                        slot.innerHTML = `
                            <div class="slot-number">${index + 1}</div>
                            <div>${index === 0 ? 'Click "Take Photo"!' : index === 1 ? 'Ready for photo 2!' : 'Final photo spot!'}</div>
                        `;
                    });
                    
                    // Update UI
                    updateUI();
                    
                    // Show message
                    showMessage("Photo strip reset! Ready for new photos! üì∏", "info");
                }
            }
            
            // Download photo strip
            async function downloadPhotoStrip() {
                if (capturedPhotos.filter(p => p).length < 3) {
                    showMessage("Complete all 3 photos first! üì∏üì∏üì∏", "warning");
                    return;
                }
                
                // Create combined strip canvas
                const stripCanvas = document.createElement('canvas');
                const stripCtx = stripCanvas.getContext('2d');
                
                // Load all photos
                const images = await Promise.all(
                    capturedPhotos.map(dataUrl => loadImage(dataUrl))
                );
                
                // Calculate dimensions
                const photoWidth = images[0].width;
                const photoHeight = images[0].height;
                const padding = 40;
                const ribbonHeight = 80;
                
                // Set canvas size
                stripCanvas.width = photoWidth * 3 + padding * 4;
                stripCanvas.height = photoHeight + padding * 2 + ribbonHeight * 2;
                
                // Draw chocolate background
                stripCtx.fillStyle = '#F5E8DA';
                stripCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);
                
                // Draw top ribbon
                drawChocolateRibbon(stripCtx, 0, 0, stripCanvas.width, ribbonHeight, 'top');
                
                // Draw photos
                images.forEach((img, index) => {
                    const x = padding + index * (photoWidth + padding);
                    const y = ribbonHeight + padding;
                    
                    // Draw photo with shadow
                    stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    stripCtx.shadowBlur = 15;
                    stripCtx.shadowOffsetY = 5;
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);
                    stripCtx.shadowBlur = 0;
                    stripCtx.shadowOffsetY = 0;
                    
                    // Draw chocolate border around photo
                    stripCtx.strokeStyle = '#8B4513';
                    stripCtx.lineWidth = 8;
                    stripCtx.strokeRect(x - 5, y - 5, photoWidth + 10, photoHeight + 10);
                    
                    // Draw gold inner border
                    stripCtx.strokeStyle = '#FFD700';
                    stripCtx.lineWidth = 4;
                    stripCtx.strokeRect(x - 2, y - 2, photoWidth + 4, photoHeight + 4);
                });
                
                // Draw bottom ribbon
                drawChocolateRibbon(stripCtx, 0, stripCanvas.height - ribbonHeight, stripCanvas.width, ribbonHeight, 'bottom');
                
                // Draw title
                stripCtx.fillStyle = '#8B4513';
                stripCtx.font = 'bold 50px "Dancing Script", cursive';
                stripCtx.textAlign = 'center';
                stripCtx.fillText('Chocolate Memories üç´', stripCanvas.width / 2, 60);
                
                // Draw date
                const date = new Date().toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                stripCtx.fillStyle = '#7B3F00';
                stripCtx.font = '25px Arial';
                stripCtx.fillText(date, stripCanvas.width / 2, stripCanvas.height - 50);
                
                // Create download link
                const link = document.createElement('a');
                link.download = `chocolate-photo-strip-${Date.now()}.png`;
                link.href = stripCanvas.toDataURL('image/png');
                link.click();
                
                // Save to gallery
                saveToGallery(stripCanvas.toDataURL('image/png'));
                
                // Show success message
                showMessage("Photo strip downloaded! Check your gallery! üéâ", "success");
            }
            
            // Draw chocolate ribbon
            function drawChocolateRibbon(ctx, x, y, width, height, position) {
                // Ribbon base
                const gradient = ctx.createLinearGradient(x, y, x, y + height);
                gradient.addColorStop(0, '#FF4757');
                gradient.addColorStop(0.5, '#FFD700');
                gradient.addColorStop(1, '#8B4513');
                
                ctx.fillStyle = gradient;
                
                if (position === 'top') {
                    ctx.fillRect(x, y, width, height);
                    // Ribbon curves
                    ctx.beginPath();
                    ctx.ellipse(x + width/2, y + height, width/4, height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.fillRect(x, y, width, height);
                    // Ribbon curves
                    ctx.beginPath();
                    ctx.ellipse(x + width/2, y, width/4, height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Chocolate decorations on ribbon
                const decorations = ['üç´', 'üç¨', 'üç™', 'üéÇ'];
                for (let i = 0; i < 8; i++) {
                    const decX = x + (width / 8) * i + (width / 16);
                    const decY = y + height / 2;
                    
                    ctx.font = '30px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(decorations[i % decorations.length], decX, decY);
                }
            }
            
            // Load image from data URL
            function loadImage(dataUrl) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = dataUrl;
                });
            }
            
            // Save to gallery
            function saveToGallery(dataUrl) {
                const photoId = Date.now();
                photoGallery.push({
                    id: photoId,
                    dataUrl: dataUrl,
                    date: new Date().toLocaleString(),
                    timestamp: Date.now()
                });
                
                // Update gallery display
                updateGallery();
            }
            
            // Update gallery display
            function updateGallery() {
                if (photoGallery.length === 0) {
                    gallerySection.style.display = 'none';
                    return;
                }
                
                gallerySection.style.display = 'block';
                galleryGrid.innerHTML = '';
                
                // Show last 6 photos
                const recentPhotos = photoGallery.slice(-6).reverse();
                
                recentPhotos.forEach(photo => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    galleryItem.innerHTML = `
                        <img class="gallery-photo" src="${photo.dataUrl}" alt="Chocolate Photo">
                        <div class="gallery-info">
                            <div style="font-weight: bold; margin-bottom: 5px;">Chocolate Strip</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">${photo.date}</div>
                        </div>
                    `;
                    
                    galleryItem.addEventListener('click', () => {
                        // Download this specific photo
                        const link = document.createElement('a');
                        link.download = `chocolate-photo-${photo.id}.png`;
                        link.href = photo.dataUrl;
                        link.click();
                    });
                    
                    galleryGrid.appendChild(galleryItem);
                });
            }
            
            // Share to chat (simulated)
            function shareToChat() {
                if (capturedPhotos.filter(p => p).length < 3) {
                    showMessage("Complete the photo strip first! üì∏", "warning");
                    return;
                }
                
                // Create a message for the chat
                const message = `I just created a chocolate photo strip! üç´üì∏ 
I took 3 photos in the chocolate photo booth! 
Check it out when you see it! üòä`;
                
                // Show message
                showMessage("Photo strip shared to chat! Check your messages! üíå", "success");
                
                // You could integrate this with your chat system here
                console.log("Shared message:", message);
                
                // For now, just show a confirmation
                setTimeout(() => {
                    alert("Photo strip shared! In a real app, this would send to your chat. üç´üíå");
                }, 500);
            }
            
            // Update UI state
            function updateUI() {
                const photosTaken = capturedPhotos.filter(p => p).length;
                
                // Update capture button text
                if (currentSlot < 3) {
                    captureBtn.innerHTML = `<i class="fas fa-camera"></i> Take Photo ${currentSlot + 1}/3`;
                } else {
                    captureBtn.innerHTML = `<i class="fas fa-check"></i> All Photos Taken!`;
                    captureBtn.disabled = true;
                }
                
                // Enable/disable download button
                downloadBtn.disabled = photosTaken < 3;
                
                // Update download button text
                if (photosTaken === 3) {
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> Download Complete Strip!`;
                } else {
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> (${photosTaken}/3) Download`;
                }
            }
            
            // Show message
            function showMessage(text, type) {
                // Create message element
                const messageEl = document.createElement('div');
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'linear-gradient(135deg, #4CAF50, #8BC34A)' : 
                                 type === 'warning' ? 'linear-gradient(135deg, #FF9800, #FFC107)' : 
                                 'linear-gradient(135deg, #2196F3, #03A9F4)'};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                    z-index: 10000;
                    animation: slideIn 0.5s ease;
                    max-width: 300px;
                `;
                messageEl.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                        <span>${text}</span>
                    </div>
                `;
                
                document.body.appendChild(messageEl);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    messageEl.style.animation = 'slideOut 0.5s ease forwards';
                    setTimeout(() => messageEl.remove(), 500);
                }, 3000);
            }
            
            // Utility: Sleep function
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // Add CSS for messages
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Initialize
            initialize();
        });
    </script>
</body>
</html>
