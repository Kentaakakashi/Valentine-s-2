<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chocolate Fun Zone!</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --chocolate-dark: #4a2c2a;
            --chocolate-medium: #7b3f00;
            --chocolate-light: #d2691e;
            --chocolate-cream: #f5e8da;
            --chocolate-milk: #8b5a2b;
            --chocolate-caramel: #d35400;
            --gold: #ffd700;
            --gold-light: #fff9c4;
            --rose: #ff6b8b;
            --mint: #98ff98;
            --strawberry: #ff6b8b;
            --bubblegum: #ffb6c1;
            --cottoncandy: #c9a0ff;
            --ribbon-red: #ff4757;
            --ribbon-gold: #ffd700;
            --ribbon-brown: #8b4513;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium), var(--chocolate-light));
            color: var(--chocolate-cream);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 80% 20%, rgba(255, 107, 139, 0.15) 0%, transparent 20%),
                radial-gradient(circle at 40% 40%, rgba(139, 69, 19, 0.15) 0%, transparent 30%);
            z-index: -1;
        }

        /* Floating Elements */
        .floating-chocolate {
            position: fixed;
            font-size: 2rem;
            z-index: 1;
            pointer-events: none;
            animation: floatAround 20s infinite linear;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px 30px;
            position: relative;
        }

        .header h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem;
            color: var(--gold-light);
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: gentleGlow 3s infinite alternate;
        }

        .header p {
            font-size: 1.4rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .cute-subtitle {
            display: inline-block;
            background: rgba(255, 182, 193, 0.3);
            padding: 10px 25px;
            border-radius: 25px;
            border: 2px solid var(--bubblegum);
            font-size: 1.2rem;
            margin-top: 20px;
            animation: bounce 2s infinite;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        /* Photo Booth Section - FIXED */
        .photo-booth {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 3px solid var(--gold);
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .booth-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            margin-bottom: 30px;
            color: var(--gold-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        /* FIXED Camera Container */
        .camera-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 40px;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 20px;
            border: 3px solid var(--chocolate-light);
        }

        .camera-view {
            width: 100%;
            height: 400px;
            background: #333;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border: 5px solid var(--chocolate-dark);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            position: relative;
            z-index: 1;
        }

        /* FIXED: Camera overlay positioned correctly */
        .camera-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 15px;
    overflow: hidden;
}


        .overlay-frame {
    width: 90%;
    height: 90%;
    border: 15px solid transparent;
    background: 
        linear-gradient(var(--chocolate-dark), var(--chocolate-dark)) padding-box,
        repeating-linear-gradient(45deg, var(--gold) 0, var(--gold) 10px, var(--chocolate-light) 10px, var(--chocolate-light) 20px) border-box;
    border-radius: 10px;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
    position: relative;
    z-index: 3; /* Changed from 3 to 2 to be ABOVE video */
        }

        /* Make video appear INSIDE the frame */
        .video-mask {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: calc(90% - 30px); /* Account for border */
    height: calc(90% - 30px);
    border-radius: 10px;
    overflow: hidden;
    z-index: 1; /* Changed from 2 to 1 to be BELOW the frame */
}


        #video-masked {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 8rem;
            color: var(--gold);
            z-index: 4;
            border-radius: 15px;
        }

        /* Photo Strip Container */
        .photo-strip-container {
            width: 100%;
            max-width: 900px;
            margin: 40px auto;
            background: var(--chocolate-cream);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            position: relative;
            border: 5px solid var(--chocolate-dark);
            transform: rotate(-1deg);
        }

        /* Chocolate Ribbons */
        .ribbon {
            position: absolute;
            background: var(--ribbon-red);
            z-index: 2;
        }

        .ribbon-1 {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: linear-gradient(90deg, var(--ribbon-red), var(--ribbon-gold));
            border-radius: 15px 15px 0 0;
        }

        .ribbon-2 {
            top: 50%;
            left: -20px;
            transform: translateY(-50%) rotate(90deg);
            width: 120px;
            height: 25px;
            background: linear-gradient(90deg, var(--ribbon-brown), var(--ribbon-gold));
            border-radius: 12px;
        }

        .ribbon-3 {
            top: 50%;
            right: -20px;
            transform: translateY(-50%) rotate(90deg);
            width: 120px;
            height: 25px;
            background: linear-gradient(90deg, var(--ribbon-gold), var(--ribbon-brown));
            border-radius: 12px;
        }

        .ribbon-4 {
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 30px;
            background: linear-gradient(90deg, var(--ribbon-gold), var(--ribbon-red));
            border-radius: 0 0 15px 15px;
        }

        /* Photo Strip */
        .photo-strip {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium));
            border-radius: 15px;
            position: relative;
            z-index: 1;
        }

        .photo-slot {
            width: 200px;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 5px solid var(--chocolate-light);
            transition: all 0.3s ease;
        }

        .photo-slot:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .photo-slot.empty {
            background: repeating-linear-gradient(45deg, 
                rgba(139, 69, 19, 0.2), 
                rgba(139, 69, 19, 0.2) 10px, 
                rgba(210, 105, 30, 0.2) 10px, 
                rgba(210, 105, 30, 0.2) 20px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: var(--chocolate-light);
        }

        .captured-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .slot-number {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--gold);
            color: var(--chocolate-dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            border: 2px solid var(--chocolate-dark);
        }

        /* Chocolate Decorations */
        .chocolate-decoration {
            position: absolute;
            font-size: 2rem;
            z-index: 2;
            pointer-events: none;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .control-btn {
            padding: 18px 35px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 200px;
            justify-content: center;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, var(--rose), var(--gold));
            color: white;
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, var(--chocolate-light), var(--chocolate-caramel));
            color: white;
        }

        .control-btn.tertiary {
            background: linear-gradient(135deg, var(--chocolate-dark), var(--chocolate-medium));
            color: var(--chocolate-cream);
            border: 2px solid var(--gold);
        }

        .control-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: translateY(-2px) scale(1.02);
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Flash Effect */
        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        /* ========== ORIGINAL FEATURES BELOW ========== */
        
        /* Chat Section */
        .chat-section {
            background: rgba(255, 182, 193, 0.2);
            border-radius: 30px;
            padding: 30px;
            margin-bottom: 40px;
            border: 3px solid var(--bubblegum);
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .chat-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 25px;
            color: var(--gold-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .chat-container {
            height: 350px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--cottoncandy);
        }

        .message {
            max-width: 75%;
            padding: 15px 20px;
            margin-bottom: 20px;
            border-radius: 25px;
            position: relative;
            animation: messagePop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.1rem;
        }

        .message.received {
            background: linear-gradient(135deg, var(--cottoncandy), #a68fff);
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .message.sent {
            background: linear-gradient(135deg, var(--bubblegum), #ff8fab);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .message-emoji {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .typing-indicator {
            display: flex;
            gap: 8px;
            padding: 15px 25px;
            background: rgba(201, 160, 255, 0.3);
            border-radius: 25px;
            width: fit-content;
            margin-bottom: 20px;
            border: 2px dashed var(--cottoncandy);
        }

        .typing-dot {
            width: 12px;
            height: 12px;
            background: var(--cottoncandy);
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        .chat-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .cute-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }

        .cute-btn.pink {
            background: linear-gradient(135deg, var(--bubblegum), var(--rose));
            color: white;
        }

        .cute-btn.purple {
            background: linear-gradient(135deg, var(--cottoncandy), #9c6bff);
            color: white;
        }

        .cute-btn.gold {
            background: linear-gradient(135deg, var(--gold), #ffcc00);
            color: var(--chocolate-dark);
        }

        /* Interactive Games Grid */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid transparent;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .game-card:hover {
            transform: translateY(-10px) rotate(2deg);
            border-color: var(--gold);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.25);
        }

        .game-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
            transition: all 0.3s ease;
        }

        .game-card:hover .game-emoji {
            transform: scale(1.3) rotate(10deg);
        }

        .game-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--gold-light);
            font-family: 'Dancing Script', cursive;
        }

        .game-desc {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        /* Chocolate Factory */
        .factory-section {
            background: rgba(255, 215, 0, 0.15);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 3px solid var(--gold);
            text-align: center;
        }

        .factory-title {
            font-family: 'Dancing Script', cursive;
            font-size: 3rem;
            margin-bottom: 30px;
            color: var(--gold-light);
        }

        .chocolate-machine {
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
            position: relative;
            cursor: pointer;
        }

        .machine-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #8b7355, #a0522d);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            border: 5px solid var(--chocolate-dark);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .machine-window {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            transition: all 0.5s ease;
        }

        .machine-button {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background: var(--rose);
            border-radius: 50%;
            border: 5px solid var(--bubblegum);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            transition: all 0.3s ease;
        }

        .machine-button:hover {
            transform: translateX(-50%) scale(1.1);
            background: var(--bubblegum);
        }

        /* Chocolate Rain Zone */
        .rain-zone {
            background: rgba(201, 160, 255, 0.15);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 3px solid var(--cottoncandy);
            text-align: center;
        }

        .rain-btn {
            padding: 20px 50px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--cottoncandy), #8a6bff);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .rain-btn:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 15px 30px rgba(138, 107, 255, 0.4);
        }

        .rain-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            min-width: 150px;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 10px;
        }

        /* Dancing Chocolate */
        .dance-party {
            background: rgba(255, 182, 193, 0.15);
            border-radius: 30px;
            padding: 40px;
            margin-bottom: 40px;
            border: 3px solid var(--bubblegum);
            text-align: center;
        }

        .dance-floor {
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .dancing-chocolate {
            font-size: 4rem;
            position: absolute;
            cursor: grab;
            transition: transform 0.1s ease;
        }

        .dancing-chocolate:active {
            cursor: grabbing;
        }

        /* Popup Messages */
        .chocolate-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, var(--chocolate-cream), #fff);
            border-radius: 25px;
            padding: 40px;
            z-index: 1000;
            color: var(--chocolate-dark);
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 5px solid var(--gold);
        }

        .chocolate-popup.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .popup-emoji {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: popupDance 1s infinite alternate;
        }

        .popup-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            color: var(--chocolate-dark);
            cursor: pointer;
            transition: transform 0.2s;
        }

        .popup-close:hover {
            transform: scale(1.2);
        }

        /* Gallery */
        .gallery-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 30px;
            padding: 40px;
            margin-top: 40px;
            border: 3px solid var(--chocolate-light);
            backdrop-filter: blur(10px);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 3px solid var(--chocolate-light);
            transition: all 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }

        .gallery-photo {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .gallery-info {
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
        }

        /* Animations */
        @keyframes gentleGlow {
            0% { text-shadow: 0 4px 8px rgba(255, 215, 0, 0.3); }
            100% { text-shadow: 0 4px 20px rgba(255, 215, 0, 0.7), 0 0 30px rgba(255, 107, 139, 0.5); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes floatAround {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(100px, 50px) rotate(90deg); }
            50% { transform: translate(50px, 100px) rotate(180deg); }
            75% { transform: translate(-50px, 50px) rotate(270deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }

        @keyframes messagePop {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes typingBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes popupDance {
            0% { transform: scale(1) rotate(-5deg); }
            100% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes countdown {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0; }
        }

        @keyframes captureFlash {
            0% { opacity: 0; }
            50% { opacity: 0.9; }
            100% { opacity: 0; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Responsive */
        @media (max-width: 900px) {
            .photo-strip {
                flex-direction: column;
                gap: 30px;
            }
            
            .photo-slot {
                width: 250px;
                height: 300px;
            }
            
            .booth-title, .chat-title, .factory-title {
                font-size: 2.8rem;
            }
            
            .camera-view {
                height: 300px;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .photo-booth, .chat-section, .factory-section, .rain-zone, .dance-party, .gallery-section {
                padding: 20px;
            }
            
            .control-btn, .cute-btn {
                min-width: 100%;
                padding: 15px 25px;
            }
            
            .controls, .chat-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .photo-slot {
                width: 200px;
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Flash Effect -->
    <div class="flash-effect" id="flash-effect"></div>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-heart"></i> Chocolate Fun Zone! <i class="fas fa-heart"></i></h1>
            <p>Complete chocolate experience made with love (and sprinkled with some error's lol üò≠)üç´üì∏‚ú®</p>
            <div class="cute-subtitle">
                <i class="fas fa-star"></i> HOPE MA BUJJI LIKES THIS ONE <i class="fas fa-star"></i>
            </div>
        </header>

        <!-- ========== PHOTO BOOTH SECTION (TOP) ========== -->
        <section class="photo-booth">
            <h2 class="booth-title">
                <i class="fas fa-camera"></i> Chocolate Photo Booth <i class="fas fa-camera"></i>
            </h2>
            
            <!-- Camera View - FIXED -->
            <div class="camera-container">
                <div class="camera-view">
                    <div class="camera-overlay">
                        <div class="overlay-frame"></div>
                        <div class="video-mask">
                            <!-- Video will be inserted here -->
                        </div>
                    </div>
                    <div class="countdown-overlay" id="countdown-overlay">3</div>
                </div>
                
                <div class="controls">
                    <button class="control-btn primary" id="start-camera">
                        <i class="fas fa-video"></i> Start Camera
                    </button>
                    <button class="control-btn secondary" id="capture-btn" disabled>
                        <i class="fas fa-camera"></i> Take Photo
                    </button>
                    <button class="control-btn tertiary" id="reset-btn">
                        <i class="fas fa-redo"></i> Reset Strip
                    </button>
                </div>
            </div>
            
            <!-- Photo Strip -->
            <div class="photo-strip-container">
                <!-- Chocolate Ribbons -->
                <div class="ribbon ribbon-1"></div>
                <div class="ribbon ribbon-2"></div>
                <div class="ribbon ribbon-3"></div>
                <div class="ribbon ribbon-4"></div>
                
                <!-- Chocolate Decorations -->
                <div class="chocolate-decoration" style="top: -30px; left: 10%;">üç´</div>
                <div class="chocolate-decoration" style="top: -30px; right: 10%;">üç¨</div>
                <div class="chocolate-decoration" style="bottom: -30px; left: 15%;">üç™</div>
                <div class="chocolate-decoration" style="bottom: -30px; right: 15%;">üéÇ</div>
                
                <div class="photo-strip" id="photo-strip">
                    <!-- Photo Slot 1 -->
                    <div class="photo-slot empty" id="slot-1">
                        <div class="slot-number">1</div>
                        <div>Click "Take Photo"!</div>
                    </div>
                    
                    <!-- Photo Slot 2 -->
                    <div class="photo-slot empty" id="slot-2">
                        <div class="slot-number">2</div>
                        <div>Ready for photo 2!</div>
                    </div>
                    
                    <!-- Photo Slot 3 -->
                    <div class="photo-slot empty" id="slot-3">
                        <div class="slot-number">3</div>
                        <div>Final photo spot!</div>
                    </div>
                </div>
            </div>
            
            <!-- Instructions -->
            <div class="instructions" style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; border-left: 5px solid var(--gold);">
                <h3 style="color: var(--gold-light); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-info-circle"></i> How to Use:
                </h3>
                <p>1. Click "Start Camera" to begin üìπ</p>
                <p>2. Position yourself in the frame like a good girlüé¨</p>
                <p>3. Click "Take Photo" countdown from 3, fastly strip down and make a pose ‚è±Ô∏è</p>
                <p>4. Take 3 photos to complete the rollüì∏üì∏üì∏</p>
                <p>5. Download your chocolate photo strip nd send it to kenta the daddy üíæ</p>
            </div>
            
            <div class="controls" style="margin-top: 40px;">
                <button class="control-btn primary" id="download-btn" disabled>
                    <i class="fas fa-download"></i> Download Photo Strip
                </button>
                <button class="control-btn secondary" id="share-btn">
                    <i class="fas fa-share-alt"></i> Share on Chat (dosent work btw)
                </button>
            </div>
        </section>

        <!-- ========== ORIGINAL FEATURES (BELOW) ========== -->

        <!-- Smart Chat Section -->
        <section class="chat-section">
            <div class="chat-title">
                <i class="fas fa-comment-heart"></i> Smart Chocolate Chat <i class="fas fa-comment-heart"></i>
            </div>
            <div class="chat-container" id="chat-container">
                <!-- Messages appear here -->
            </div>
            <div class="chat-controls">
                <button class="cute-btn pink" id="send-sweet">
                    <i class="fas fa-candy-cane"></i> Sweet Message
                </button>
                <button class="cute-btn purple" id="send-funny">
                    <i class="fas fa-laugh-squint"></i> Funny Message
                </button>
                <button class="cute-btn gold" id="send-love">
                    <i class="fas fa-heart"></i> Love Message
                </button>
            </div>
        </section>

        <!-- Interactive Games -->
        <section>
            <h2 class="chat-title"><i class="fas fa-gamepad"></i> Chocolate Mini-Games</h2>
            <div class="games-grid">
                <div class="game-card" id="pop-game">
                    <div class="game-emoji">üéàüç´</div>
                    <div class="game-title">Chocolate Popper</div>
                    <div class="game-desc">Tap to pop chocolate bubbles muhehehehe</div>
                </div>

                <div class="game-card" id="catch-game">
                    <div class="game-emoji">üïπÔ∏èüç´</div>
                    <div class="game-title">Chocolate Catcher</div>
                    <div class="game-desc">Catch falling chocolates in your basket üòº</div>
                </div>

                <div class="game-card" id="dance-game">
                    <div class="game-emoji">üíÉüç´</div>
                    <div class="game-title">Chocolate Dance</div>
                    <div class="game-desc">Make chocolates dance to the music üï∫ YIPPYYYYY</div>
                </div>
            </div>
        </section>

        <!-- Chocolate Factory -->
        <section class="factory-section">
            <h2 class="factory-title"><i class="fas fa-industry"></i> Magical Chocolate Machine</h2>
            <p style="margin-bottom: 30px; font-size: 1.2rem;">Click the button to make surprise chocolates üç´‚ú® SECRET CHOCLATE INCLUDED</p>
            
            <div class="chocolate-machine" id="chocolate-machine">
                <div class="machine-body">
                    <div class="machine-window" id="machine-window">‚ùì</div>
                    <div class="machine-button" id="machine-button">
                        <i class="fas fa-play"></i>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <div style="font-size: 1.3rem; color: var(--gold-light); margin-bottom: 10px;">
                    Chocolates Made: <span id="machine-count">0</span>
                </div>
            </div>
        </section>

        <!-- Chocolate Rain -->
        <section class="rain-zone">
            <h2 class="factory-title"><i class="fas fa-cloud-rain"></i> Chocolate Rain Maker</h2>
            <p style="margin-bottom: 30px; font-size: 1.2rem;">Make it rain chocolate Click as much as you want</p>
            
            <button class="rain-btn" id="rain-btn">
                <i class="fas fa-cloud-showers-heavy"></i> MAKE IT RAIN CHOCOLATE üòçüéÄü´∂<i class="fas fa-cloud-showers-heavy"></i>
            </button>
            
            <div class="rain-stats">
                <div class="stat-box">
                    <div class="stat-number" id="rain-count">0</div>
                    <div>Rain Sessions</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="chocolate-count">0</div>
                    <div>Total Chocolates</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="click-count">0</div>
                    <div>Clicks Today</div>
                </div>
            </div>
        </section>

        <!-- Dancing Chocolate Party -->
        <section class="dance-party">
            <h2 class="chat-title"><i class="fas fa-music"></i> Chocolate Dance Party</h2>
            <p style="margin-bottom: 30px; font-size: 1.2rem;">Drag the chocolates to make them dance! Click to add more dancers!</p>
            
            <div class="dance-floor" id="dance-floor">
                <div style="opacity: 0.7; font-size: 1.2rem;">Drag me around! üï∫üíÉ</div>
            </div>
            
            <div class="chat-controls">
                <button class="cute-btn pink" id="add-dancer">
                    <i class="fas fa-plus"></i> Add Dancer
                </button>
                <button class="cute-btn purple" id="clear-dance">
                    <i class="fas fa-broom"></i> Clear Floor
                </button>
                <button class="cute-btn gold" id="dance-party-btn">
                    <i class="fas fa-play"></i> Start Dance Party!
                </button>
            </div>
        </section>

        <!-- Gallery Section -->
        <section class="gallery-section" id="gallery-section" style="display: none;">
            <h2 class="booth-title">
                <i class="fas fa-images"></i> Your Chocolate Photo Gallery <i class="fas fa-images"></i>
            </h2>
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be added here -->
            </div>
        </section>
    </div>

    <!-- Chocolate Popup -->
    <div class="chocolate-popup" id="chocolate-popup">
        <button class="popup-close" id="popup-close">&times;</button>
        <div class="popup-emoji" id="popup-emoji">üç´</div>
        <h3 id="popup-title">Sweet!</h3>
        <p id="popup-message">You made something awesome di bujjjjjuuu!</p>
    </div>

    <script>
        // ========== PHOTO BOOTH CODE ==========
        document.addEventListener('DOMContentLoaded', function() {
            // State variables for Photo Booth
            let stream = null;
            let capturedPhotos = [null, null, null];
            let currentSlot = 0;
            let isCapturing = false;
            let photoGallery = [];
            let photoBoothActive = false;
            
            // State variables for Original Features
            let rainCount = 0;
            let totalChocolates = 0;
            let clickCount = 0;
            let machineCount = 0;
            let dancers = [];
            
            // DOM Elements - Photo Booth
            const startCameraBtn = document.getElementById('start-camera');
            const captureBtn = document.getElementById('capture-btn');
            const resetBtn = document.getElementById('reset-btn');
            const downloadBtn = document.getElementById('download-btn');
            const shareBtn = document.getElementById('share-btn');
            const countdownOverlay = document.getElementById('countdown-overlay');
            const flashEffect = document.getElementById('flash-effect');
            const photoStrip = document.getElementById('photo-strip');
            const gallerySection = document.getElementById('gallery-section');
            const galleryGrid = document.getElementById('gallery-grid');
            
            // DOM Elements - Original Features
            const chatContainer = document.getElementById('chat-container');
            const sendSweetBtn = document.getElementById('send-sweet');
            const sendFunnyBtn = document.getElementById('send-funny');
            const sendLoveBtn = document.getElementById('send-love');
            const rainBtn = document.getElementById('rain-btn');
            const rainCountEl = document.getElementById('rain-count');
            const chocolateCountEl = document.getElementById('chocolate-count');
            const clickCountEl = document.getElementById('click-count');
            const machineButton = document.getElementById('machine-button');
            const machineWindow = document.getElementById('machine-window');
            const machineCountEl = document.getElementById('machine-count');
            const danceFloor = document.getElementById('dance-floor');
            const addDancerBtn = document.getElementById('add-dancer');
            const clearDanceBtn = document.getElementById('clear-dance');
            const dancePartyBtn = document.getElementById('dance-party-btn');
            const chocolatePopup = document.getElementById('chocolate-popup');
            
            // Photo slots
            const photoSlots = [
                document.getElementById('slot-1'),
                document.getElementById('slot-2'),
                document.getElementById('slot-3')
            ];
            
            // Video mask element (FIXED)
            const videoMask = document.querySelector('.video-mask');
            
            // Response database for smart chat
            const smartResponses = {
                sweet: {
                    messages: [
                        "You're sweeter than the sweetest chocolate I've ever ate üòºüç´",
                        "You ma bujju makes ma day sweet af with just texts, imagine about IRL‚ú®",
                        "GIMME A HUGE AHHHHH HUG RNNN ü§óüç´",
                        "You deserve all the chocolate in the world (ill take 99.9% of it as my share btw üòº, you only get 1 üòà) üåçüç´"
                    ],
                    responses: [
                        { text: "Uh huhhhhhhhhh üôàüôàüéÄü´∂", emoji: "üíï" },
                        { text: "IFKRRRRR WOULD BE AWSOME üòç", emoji: "ü•∞" },
                        { text: "COME HEREEEEE MWAHHHHHHHHHHHHH! ‚ú®", emoji: "‚ú®" },
                        { text: "99.9% is crazy lmao üò≠", emoji: "üòä" }
                    ]
                },
                funny: {
                    messages: [
                        "Why did the chocolate go to the doctor? Because it was feeling a little choc-olate üò∑ (please laugh)",
                        "If you we're a sweet, youd be a lemon for sure üòº",
                        "Why don't chocolates ever win race'S?... OBVIOUSLY CHOCLATES CANT RACE YOU DUMBAHHHHHHüèéÔ∏è"
                    ],
                    responses: [
                        { text: "Lol ü§≠", emoji: "ü§£" },
                        { text: "Bu5 lemon is not a sw- ü§î. OHHHHH üôà", emoji: "ü´°" },
                        { text: "Oh yea, totally a joke ü§å", emoji: "üèéÔ∏è" }
                    ]
                },
                love: {
                    messages: [
                        "I love you more than I love __________, fill anything in that bar and its a true statement",
                        " when we meet for first time i'll hug ya till you melt like a chocococococcocolate ü•∫",
                        "This day can't be any more sweet... unless you use that photobooth above to send me a pi-"
                    ],
                    responses: [
                        { text: "Damn üôà", emoji: "ü•∫" },
                        { text: "Awwwwwwwwww dats so sweet ü§≠üòù, lets see if you can make eye contact first", emoji: "ü•∞" },
                        { text: "Nuhhhhhh aint no way, everyone is home poda üôà, but I'd love to", emoji: "ü•õ" }
                    ]
                }
            };
            
            // Chocolate types for machine
            const chocolateTypes = [
                { emoji: "üç´", name: "Classic Chocolate", color: "#8B4513" },
                { emoji: "üç¨", name: "Candy Chocolate", color: "#FF69B4" },
                { emoji: "üç©", name: "Donut Chocolate", color: "#8B7355" },
                { emoji: "üç™", name: "Cookie Chocolate", color: "#D2691E" },
                { emoji: "üéÇ", name: "Cake Chocolate", color: "#FFD700" },
                { emoji: "üßÅ", name: "Cupcake Chocolate", color: "#FFB6C1" },
                { emoji: "üåü", name: "Sparkly Chocolate", color: "#FFD700" },
                { emoji: "üíé", name: "Diamond Chocolate", color: "#B9F2FF" }
            ];
            
            // Initialize everything
            function initialize() {
                createFloatingChocolates();
                createChocolateDecorations();
                setupEventListeners();
                startChat();
                updateStats();
                updateUI();
            }
            
            // ========== PHOTO BOOTH FUNCTIONS ==========
            
            // Create floating chocolate decorations
            function createChocolateDecorations() {
                const decorations = ['üç´', 'üç¨', 'üç™', 'üéÇ', 'üßÅ', 'üç©', 'üç∞', 'üíù'];
                const container = document.querySelector('.photo-strip-container');
                
                for (let i = 0; i < 8; i++) {
                    const decor = document.createElement('div');
                    decor.className = 'chocolate-decoration';
                    decor.textContent = decorations[Math.floor(Math.random() * decorations.length)];
                    decor.style.left = Math.random() * 100 + '%';
                    decor.style.top = Math.random() * 100 + '%';
                    decor.style.fontSize = (Math.random() * 20 + 20) + 'px';
                    decor.style.opacity = Math.random() * 0.7 + 0.3;
                    decor.style.animation = `float ${Math.random() * 5 + 5}s infinite ease-in-out`;
                    decor.style.animationDelay = Math.random() * 2 + 's';
                    
                    container.appendChild(decor);
                }
            }
            
            // Start camera - FIXED VERSION
            async function startCamera() {
                try {
                    if (stream) {
                        // Stop existing stream
                        stream.getTracks().forEach(track => track.stop());
                        stream = null;
                        
                        // Remove video element
                        const existingVideo = videoMask.querySelector('video');
                        if (existingVideo) {
                            existingVideo.remove();
                        }
                        
                        startCameraBtn.innerHTML = '<i class="fas fa-video"></i> Start Camera';
                        captureBtn.disabled = true;
                        photoBoothActive = false;
                        updateUI();
                        return;
                    }
                    
                    // Request camera access
                    stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { 
                            facingMode: 'user',
                            width: { ideal: 1280 },
                            height: { ideal: 720 }
                        },
                        audio: false 
                    });
                    
                    // Create video element INSIDE the mask
                    const video = document.createElement('video');
                    video.autoplay = true;
                    video.playsInline = true;
                    video.style.width = '100%';
                    video.style.height = '100%';
                    video.style.objectFit = 'cover';
                    video.style.transform = 'scaleX(-1)'; // Mirror effect
                    
                    // Set video source
// Start camera - FIXED VERSION
async function startCamera() {
    try {
        if (stream) {
            // Stop existing stream
            stream.getTracks().forEach(track => track.stop());
            stream = null;
            
            // Remove video element
            const existingVideo = videoMask.querySelector('video');
            if (existingVideo) {
                existingVideo.remove();
            }
            
            startCameraBtn.innerHTML = '<i class="fas fa-video"></i> Start Camera';
            captureBtn.disabled = true;
            photoBoothActive = false;
            updateUI();
            return;
        }
        
        // Request camera access
        stream = await navigator.mediaDevices.getUserMedia({ 
            video: { 
                facingMode: 'user',
                width: { ideal: 1280 },
                height: { ideal: 720 }
            },
            audio: false 
        });
        
        // Create video element INSIDE the mask
        const video = document.createElement('video');
        video.id = 'video-preview';
        video.autoplay = true;
        video.playsInline = true;
        video.style.width = '100%';
        video.style.height = '100%';
        video.style.objectFit = 'cover';
        video.style.transform = 'scaleX(-1)'; // Mirror effect
        video.style.borderRadius = '10px'; // Match the mask
        
        // Set video source
        video.srcObject = stream;
        
        // Clear any existing video and add new one
        videoMask.innerHTML = '';
        videoMask.appendChild(video);
        
        startCameraBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Stop Camera';
        captureBtn.disabled = false;
        photoBoothActive = true;
        
        // Camera started message
        showMessage("Camera started! Get ready to smile! üòä", "success");
        
        // FIX: Force a reflow to ensure video is visible
        setTimeout(() => {
            video.style.opacity = '1';
        }, 100);
        
    } catch (error) {
        console.error('Camera error:', error);
        showMessage("Couldn't access camera. Using demo mode! üì∏", "warning");
        
        // Fallback: Show placeholder in video mask
        videoMask.innerHTML = `
            <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; 
                 background:linear-gradient(45deg, #4a2c2a, #7b3f00); color:#ffd700; font-size:2rem; text-align:center; padding:20px; border-radius:10px;">
                <div>
                    <div style="font-size:4rem;">üì∏</div>
                    Camera Demo Mode<br>
                    <small style="font-size:1rem;">Position yourself here!</small>
                </div>
            </div>
        `;
        captureBtn.disabled = false;
        startCameraBtn.innerHTML = '<i class="fas fa-stop-circle"></i> Demo Mode';
        photoBoothActive = true;
    }
    
    updateUI();
}

                
            
            // Capture photo with countdown
            async function capturePhoto() {
                if (isCapturing || currentSlot >= 3) return;
                
                isCapturing = true;
                captureBtn.disabled = true;
                
                // Countdown from 3
                countdownOverlay.style.display = 'flex';
                
                for (let i = 3; i > 0; i--) {
                    countdownOverlay.textContent = i;
                    countdownOverlay.style.animation = 'countdown 1s';
                    await sleep(1000);
                }
                
                // Hide countdown
                countdownOverlay.style.display = 'none';
                
                // Flash effect
                flashEffect.style.animation = 'captureFlash 0.5s';
                
                // Create canvas for photo
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Get video element from mask
                const video = videoMask.querySelector('video');
                
                if (video && video.srcObject) {
                    // Real camera mode
                    canvas.width = video.videoWidth || 800;
                    canvas.height = video.videoHeight || 600;
                    
                    // Draw video frame (mirrored)
                    ctx.save();
                    ctx.scale(-1, 1);
                    ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
                    ctx.restore();
                } else {
                    // Demo mode
                    canvas.width = 800;
                    canvas.height = 600;
                    
                    // Draw demo background
                    ctx.fillStyle = '#4a2c2a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw smiley face
                    ctx.fillStyle = '#ffd700';
                    ctx.font = 'bold 100px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('üòä', canvas.width/2, canvas.height/2 - 50);
                    
                    // Draw text
                    ctx.font = '40px Arial';
                    ctx.fillText('Demo Photo', canvas.width/2, canvas.height/2 + 100);
                    ctx.font = '30px Arial';
                    ctx.fillText(`Slot ${currentSlot + 1}`, canvas.width/2, canvas.height/2 + 150);
                }
                
                // Add chocolate frame overlay
                addChocolateFrame(ctx, canvas);
                
                // Get data URL
                const dataUrl = canvas.toDataURL('image/png');
                
                // Store photo
                capturedPhotos[currentSlot] = dataUrl;
                
                // Update photo slot
                updatePhotoSlot(currentSlot, dataUrl);
                
                // Move to next slot
                currentSlot++;
                
                // Update UI
                updateUI();
                
                // Show success message
                showMessage(`Photo ${currentSlot}/3 captured! üéâ`, "success");
                
                // Shake animation for photo strip
                photoStrip.parentElement.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    photoStrip.parentElement.style.animation = '';
                }, 500);
                
                isCapturing = false;
                captureBtn.disabled = false;
                
                // Remove flash effect
                setTimeout(() => {
                    flashEffect.style.animation = '';
                }, 500);
            }
            
            // Add chocolate frame to photo
            function addChocolateFrame(ctx, canvas) {
                // Draw chocolate border
                ctx.save();
                
                // Outer chocolate border
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 20;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                
                // Inner gold border
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 10;
                ctx.strokeRect(25, 25, canvas.width - 50, canvas.height - 50);
                
                // Chocolate corner decorations
                const corners = [
                    [30, 30],
                    [canvas.width - 30, 30],
                    [30, canvas.height - 30],
                    [canvas.width - 30, canvas.height - 30]
                ];
                
                corners.forEach(([x, y]) => {
                    ctx.fillStyle = '#FFD700';
                    ctx.beginPath();
                    ctx.arc(x, y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#8B4513';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('üç´', x, y);
                });
                
                // Chocolate-themed text at bottom
                ctx.fillStyle = '#FFD700';
                ctx.font = 'bold 30px "Dancing Script", cursive';
                ctx.textAlign = 'center';
                ctx.fillText('Sweet Memory üç´', canvas.width / 2, canvas.height - 40);
                
                // Slot number
                ctx.fillStyle = '#8B4513';
                ctx.font = 'bold 40px Arial';
                ctx.fillText(`#${currentSlot + 1}`, canvas.width / 2, 60);
                
                ctx.restore();
            }
            
            // Update photo slot with captured photo
            function updatePhotoSlot(slotIndex, dataUrl) {
                const slot = photoSlots[slotIndex];
                slot.classList.remove('empty');
                slot.innerHTML = `
                    <div class="slot-number">${slotIndex + 1}</div>
                    <img class="captured-photo" src="${dataUrl}" alt="Captured Photo ${slotIndex + 1}">
                `;
            }
            
            // Reset photo strip
            function resetPhotoStrip() {
                if (confirm("Reset all photos and start over?")) {
                    capturedPhotos = [null, null, null];
                    currentSlot = 0;
                    
                    // Reset slots
                    photoSlots.forEach((slot, index) => {
                        slot.classList.add('empty');
                        slot.innerHTML = `
                            <div class="slot-number">${index + 1}</div>
                            <div>${index === 0 ? 'Click "Take Photo"!' : index === 1 ? 'Ready for photo 2!' : 'Final photo spot!'}</div>
                        `;
                    });
                    
                    // Update UI
                    updateUI();
                    
                    // Show message
                    showMessage("Photo strip reset! Ready for new photos! üì∏", "info");
                }
            }
            
            // Download photo strip
            async function downloadPhotoStrip() {
                if (capturedPhotos.filter(p => p).length < 3) {
                    showMessage("Complete all 3 photos first! üì∏üì∏üì∏", "warning");
                    return;
                }
                
                // Create combined strip canvas
                const stripCanvas = document.createElement('canvas');
                const stripCtx = stripCanvas.getContext('2d');
                
                // Load all photos
                const images = await Promise.all(
                    capturedPhotos.map(dataUrl => loadImage(dataUrl))
                );
                
                // Calculate dimensions
                const photoWidth = images[0].width;
                const photoHeight = images[0].height;
                const padding = 40;
                const ribbonHeight = 80;
                
                // Set canvas size
                stripCanvas.width = photoWidth * 3 + padding * 4;
                stripCanvas.height = photoHeight + padding * 2 + ribbonHeight * 2;
                
                // Draw chocolate background
                stripCtx.fillStyle = '#F5E8DA';
                stripCtx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);
                
                // Draw top ribbon
                drawChocolateRibbon(stripCtx, 0, 0, stripCanvas.width, ribbonHeight, 'top');
                
                // Draw photos
                images.forEach((img, index) => {
                    const x = padding + index * (photoWidth + padding);
                    const y = ribbonHeight + padding;
                    
                    // Draw photo with shadow
                    stripCtx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                    stripCtx.shadowBlur = 15;
                    stripCtx.shadowOffsetY = 5;
                    stripCtx.drawImage(img, x, y, photoWidth, photoHeight);
                    stripCtx.shadowBlur = 0;
                    stripCtx.shadowOffsetY = 0;
                    
                    // Draw chocolate border around photo
                    stripCtx.strokeStyle = '#8B4513';
                    stripCtx.lineWidth = 8;
                    stripCtx.strokeRect(x - 5, y - 5, photoWidth + 10, photoHeight + 10);
                    
                    // Draw gold inner border
                    stripCtx.strokeStyle = '#FFD700';
                    stripCtx.lineWidth = 4;
                    stripCtx.strokeRect(x - 2, y - 2, photoWidth + 4, photoHeight + 4);
                });
                
                // Draw bottom ribbon
                drawChocolateRibbon(stripCtx, 0, stripCanvas.height - ribbonHeight, stripCanvas.width, ribbonHeight, 'bottom');
                
                // Draw title
                stripCtx.fillStyle = '#8B4513';
                stripCtx.font = 'bold 50px "Dancing Script", cursive';
                stripCtx.textAlign = 'center';
                stripCtx.fillText('Chocolate Memories üç´', stripCanvas.width / 2, 60);
                
                // Draw date
                const date = new Date().toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                stripCtx.fillStyle = '#7B3F00';
                stripCtx.font = '25px Arial';
                stripCtx.fillText(date, stripCanvas.width / 2, stripCanvas.height - 50);
                
                // Create download link
                const link = document.createElement('a');
                link.download = `chocolate-photo-strip-${Date.now()}.png`;
                link.href = stripCanvas.toDataURL('image/png');
                link.click();
                
                // Save to gallery
                saveToGallery(stripCanvas.toDataURL('image/png'));
                
                // Show success message
                showMessage("Photo strip downloaded! Check your gallery! üéâ", "success");
            }
            
            // Draw chocolate ribbon
            function drawChocolateRibbon(ctx, x, y, width, height, position) {
                // Ribbon base
                const gradient = ctx.createLinearGradient(x, y, x, y + height);
                gradient.addColorStop(0, '#FF4757');
                gradient.addColorStop(0.5, '#FFD700');
                gradient.addColorStop(1, '#8B4513');
                
                ctx.fillStyle = gradient;
                
                if (position === 'top') {
                    ctx.fillRect(x, y, width, height);
                    // Ribbon curves
                    ctx.beginPath();
                    ctx.ellipse(x + width/2, y + height, width/4, height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.fillRect(x, y, width, height);
                    // Ribbon curves
                    ctx.beginPath();
                    ctx.ellipse(x + width/2, y, width/4, height/2, 0, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Chocolate decorations on ribbon
                const decorations = ['üç´', 'üç¨', 'üç™', 'üéÇ'];
                for (let i = 0; i < 8; i++) {
                    const decX = x + (width / 8) * i + (width / 16);
                    const decY = y + height / 2;
                    
                    ctx.font = '30px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(decorations[i % decorations.length], decX, decY);
                }
            }
            
            // Load image from data URL
            function loadImage(dataUrl) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = dataUrl;
                });
            }
            
            // Save to gallery
            function saveToGallery(dataUrl) {
                const photoId = Date.now();
                photoGallery.push({
                    id: photoId,
                    dataUrl: dataUrl,
                    date: new Date().toLocaleString(),
                    timestamp: Date.now()
                });
                
                // Update gallery display
                updateGallery();
            }
            
            // Update gallery display
            function updateGallery() {
                if (photoGallery.length === 0) {
                    gallerySection.style.display = 'none';
                    return;
                }
                
                gallerySection.style.display = 'block';
                galleryGrid.innerHTML = '';
                
                // Show last 6 photos
                const recentPhotos = photoGallery.slice(-6).reverse();
                
                recentPhotos.forEach(photo => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    galleryItem.innerHTML = `
                        <img class="gallery-photo" src="${photo.dataUrl}" alt="Chocolate Photo">
                        <div class="gallery-info">
                            <div style="font-weight: bold; margin-bottom: 5px;">Chocolate Strip</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">${photo.date}</div>
                        </div>
                    `;
                    
                    galleryItem.addEventListener('click', () => {
                        // Download this specific photo
                        const link = document.createElement('a');
                        link.download = `chocolate-photo-${photo.id}.png`;
                        link.href = photo.dataUrl;
                        link.click();
                    });
                    
                    galleryGrid.appendChild(galleryItem);
                });
            }
            
            // Share to chat (simulated)
            function shareToChat() {
                if (capturedPhotos.filter(p => p).length < 3) {
                    showMessage("Complete the photo strip first! üì∏", "warning");
                    return;
                }
                
                // Create a message for the chat
                const message = `I just created a chocolate photo strip! üç´üì∏ 
I took 3 photos in the chocolate photo booth! 
Check it out when you see it! üòä`;
                
                // Show message
                showMessage("Photo strip shared to chat! Check your messages! üíå", "success");
                
                // You could integrate this with your chat system here
                console.log("Shared message:", message);
                
                // For now, just show a confirmation
                setTimeout(() => {
                    alert("Photo strip shared! In a real app, this would send to your chat. üç´üíå");
                }, 500);
            }
            
            // ========== ORIGINAL FEATURES FUNCTIONS ==========
            
            // Create floating chocolates
            function createFloatingChocolates() {
                const floatingEl = document.getElementById('floating-elements');
                if (!floatingEl) return;
                
                const emojis = ["üç´", "üç¨", "üç™", "üç©", "üéÇ", "üßÅ", "üåü", "üíñ"];
                
                for (let i = 0; i < 10; i++) {
                    const chocolate = document.createElement('div');
                    chocolate.className = 'floating-chocolate';
                    chocolate.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    chocolate.style.left = Math.random() * 100 + 'vw';
                    chocolate.style.top = Math.random() * 100 + 'vh';
                    chocolate.style.fontSize = (Math.random() * 30 + 20) + 'px';
                    chocolate.style.opacity = Math.random() * 0.5 + 0.3;
                    chocolate.style.animationDuration = (Math.random() * 20 + 20) + 's';
                    floatingEl.appendChild(chocolate);
                }
            }
            
            // Start chat
            function startChat() {
                addMessage("Welcome to the complete Chocolate Fun Zone! üéâ", "received", "üéâ");
                addMessage("We have the photo booth at top and all original features below! üç´", "received", "üç´");
                addMessage("Try everything! The camera is now fixed! üì∏", "received", "üì∏");
                
                // Auto-send first message
                setTimeout(() => {
                    sendMessage('sweet');
                }, 1500);
            }
            
            // Add message to chat
            function addMessage(text, type, emoji = "üç´") {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${type}`;
                messageEl.innerHTML = `
                    <span class="message-emoji">${emoji}</span>
                    ${text}
                `;
                chatContainer.appendChild(messageEl);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Show typing indicator
            function showTypingIndicator(callback) {
                const typingEl = document.createElement('div');
                typingEl.className = 'typing-indicator';
                typingEl.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                chatContainer.appendChild(typingEl);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                setTimeout(() => {
                    typingEl.remove();
                    if (callback) callback();
                }, 1000 + Math.random() * 1000);
            }
            
            // Send message with smart reply
            function sendMessage(type) {
                const messages = smartResponses[type].messages;
                const responses = smartResponses[type].responses;
                
                // Get random message
                const messageIndex = Math.floor(Math.random() * messages.length);
                const userMessage = messages[messageIndex];
                
                // Add user message
                addMessage(userMessage, 'sent');
                
                // Show typing indicator
                showTypingIndicator(() => {
                    // Get matching response
                    const response = responses[messageIndex] || responses[0];
                    addMessage(response.text, 'received', response.emoji);
                });
            }
            
            // Make chocolate in machine
            function makeChocolate() {
                machineCount++;
                machineCountEl.textContent = machineCount;
                
                // Random chocolate type
                const chocolate = chocolateTypes[Math.floor(Math.random() * chocolateTypes.length)];
                
                // Animate machine
                machineWindow.textContent = "‚öôÔ∏è";
                machineWindow.style.transform = "translate(-50%, -50%) rotate(180deg)";
                
                setTimeout(() => {
                    machineWindow.textContent = chocolate.emoji;
                    machineWindow.style.transform = "translate(-50%, -50%) rotate(0deg)";
                    machineWindow.style.color = chocolate.color;
                    
                    // Show popup
                    showPopup(chocolate.name, `You made a ${chocolate.name.toLowerCase()}!`, chocolate.emoji);
                    
                    // Add chat message
                    addMessage(`I made a ${chocolate.name.toLowerCase()} in the machine! ${chocolate.emoji}`, "sent", chocolate.emoji);
                    showTypingIndicator(() => {
                        addMessage("That looks delicious! You're so creative! üë®‚Äçüç≥", "received", "üë®‚Äçüç≥");
                    });
                }, 500);
            }
            
            // Make it rain chocolate
            function makeItRain() {
                rainCount++;
                totalChocolates += 50;
                updateStats();
                
                // Create rain effect
                const particles = document.getElementById('floating-elements');
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const chocolate = document.createElement('div');
                        chocolate.className = 'floating-chocolate';
                        chocolate.textContent = ['üç´', 'üç¨', 'üç™', 'üç©', 'üåü', 'üíñ'][Math.floor(Math.random() * 6)];
                        chocolate.style.left = Math.random() * 100 + 'vw';
                        chocolate.style.top = '-50px';
                        chocolate.style.fontSize = (Math.random() * 30 + 20) + 'px';
                        chocolate.style.animation = 'floatAround 5s linear forwards';
                        chocolate.style.animationDuration = '3s';
                        
                        particles.appendChild(chocolate);
                        
                        setTimeout(() => {
                            chocolate.remove();
                        }, 3000);
                    }, i * 30);
                }
                
                // Show popup
                showPopup("Chocolate Rain! üåßÔ∏è", "It's raining chocolates!", "üç´");
                
                // Add chat message
                addMessage("I made it rain chocolate! üåßÔ∏èüç´", "sent", "üåßÔ∏è");
                showTypingIndicator(() => {
                    addMessage("Wow! That looks amazing! So many chocolates! ‚ú®", "received", "‚ú®");
                });
            }
            
            // Add dancer to floor
            function addDancer() {
                const dancer = document.createElement('div');
                dancer.className = 'dancing-chocolate';
                dancer.textContent = ['üç´', 'üç¨', 'üç™', 'üéÇ', 'üßÅ', 'üåü'][Math.floor(Math.random() * 6)];
                dancer.style.left = Math.random() * 80 + 10 + '%';
                dancer.style.top = Math.random() * 80 + 10 + '%';
                
                // Make draggable
                makeDraggable(dancer);
                
                danceFloor.appendChild(dancer);
                dancers.push(dancer);
                
                // Show popup if first dancer
                if (dancers.length === 1) {
                    showPopup("Dancer Added! üíÉ", "Drag the chocolate around to make it dance!", "üíÉ");
                }
            }
            
            // Make element draggable
            function makeDraggable(element) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                
                element.onmousedown = dragMouseDown;
                element.ontouchstart = dragTouchStart;
                
                function dragMouseDown(e) {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                }
                
                function dragTouchStart(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    pos3 = touch.clientX;
                    pos4 = touch.clientY;
                    document.ontouchend = closeDragElement;
                    document.ontouchmove = elementDragTouch;
                }
                
                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    
                    const newTop = element.offsetTop - pos2;
                    const newLeft = element.offsetLeft - pos1;
                    
                    // Keep within bounds
                    if (newTop >= 0 && newTop <= danceFloor.offsetHeight - 60) {
                        element.style.top = newTop + "px";
                    }
                    if (newLeft >= 0 && newLeft <= danceFloor.offsetWidth - 60) {
                        element.style.left = newLeft + "px";
                    }
                }
                
                function elementDragTouch(e) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    pos1 = pos3 - touch.clientX;
                    pos2 = pos4 - touch.clientY;
                    pos3 = touch.clientX;
                    pos4 = touch.clientY;
                    
                    const newTop = element.offsetTop - pos2;
                    const newLeft = element.offsetLeft - pos1;
                    
                    // Keep within bounds
                    if (newTop >= 0 && newTop <= danceFloor.offsetHeight - 60) {
                        element.style.top = newTop + "px";
                    }
                    if (newLeft >= 0 && newLeft <= danceFloor.offsetWidth - 60) {
                        element.style.left = newLeft + "px";
                    }
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                    document.ontouchend = null;
                    document.ontouchmove = null;
                }
            }
            
            // Clear dance floor
            function clearDanceFloor() {
                dancers.forEach(dancer => dancer.remove());
                dancers = [];
                showPopup("Clean Floor! üßπ", "All dancers cleared! Add new ones!", "üßπ");
            }
            
            // Start dance party
            function startDanceParty() {
                dancers.forEach(dancer => {
                    dancer.style.animation = "wiggle 0.5s infinite alternate";
                });
                
                // Add party effects
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        createParticle(["üéâ", "‚ú®", "üåü", "üéä"][Math.floor(Math.random() * 4)], 
                            Math.random() * window.innerWidth, 
                            Math.random() * window.innerHeight);
                    }, i * 100);
                }
                
                showPopup("Dance Party! üéä", "All chocolates are dancing! Woo!", "üéâ");
                
                // Stop after 5 seconds
                setTimeout(() => {
                    dancers.forEach(dancer => {
                        dancer.style.animation = "";
                    });
                }, 5000);
            }
            
            // Create particle effect
            function createParticle(emoji, x, y) {
                const particle = document.createElement('div');
                particle.style.position = 'fixed';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.fontSize = '25px';
                particle.style.opacity = '1';
                particle.style.zIndex = '1000';
                particle.style.pointerEvents = 'none';
                particle.textContent = emoji;
                
                document.body.appendChild(particle);
                
                // Random movement
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 3 + 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                let posX = x;
                let posY = y;
                let opacity = 1;
                
                function animate() {
                    posX += vx;
                    posY += vy;
                    opacity -= 0.02;
                    
                    particle.style.left = posX + 'px';
                    particle.style.top = posY + 'px';
                    particle.style.opacity = opacity;
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                }
                
                animate();
            }
            
            // ========== SHARED FUNCTIONS ==========
            
            // Setup event listeners
            function setupEventListeners() {
                // Photo Booth buttons
                startCameraBtn.addEventListener('click', startCamera);
                captureBtn.addEventListener('click', capturePhoto);
                resetBtn.addEventListener('click', resetPhotoStrip);
                downloadBtn.addEventListener('click', downloadPhotoStrip);
                shareBtn.addEventListener('click', shareToChat);
                
                // Chat buttons
                sendSweetBtn.addEventListener('click', () => sendMessage('sweet'));
                sendFunnyBtn.addEventListener('click', () => sendMessage('funny'));
                sendLoveBtn.addEventListener('click', () => sendMessage('love'));
                
                // Original features buttons
                rainBtn.addEventListener('click', makeItRain);
                machineButton.addEventListener('click', makeChocolate);
                addDancerBtn.addEventListener('click', addDancer);
                clearDanceBtn.addEventListener('click', clearDanceFloor);
                dancePartyBtn.addEventListener('click', startDanceParty);
                
                // Close popup
                document.getElementById('popup-close').addEventListener('click', () => {
                    chocolatePopup.classList.remove('active');
                });
                
                // Game cards
                document.querySelectorAll('.game-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const game = this.id;
                        let message = "";
                        
                        switch(game) {
                            case 'pop-game':
                                message = "Let's play the chocolate popping game! üéà";
                                break;
                            case 'catch-game':
                                message = "Chocolate catching time! üïπÔ∏è";
                                break;
                            case 'dance-game':
                                message = "Dance party with chocolate! üíÉ";
                                break;
                        }
                        
                        addMessage(message, 'sent');
                        
                        showTypingIndicator(() => {
                            const responses = [
                                "Yay! I love games! üéÆ",
                                "Ready when you are! üèÜ",
                                "Games with you are the best! üé™"
                            ];
                            const response = responses[Math.floor(Math.random() * responses.length)];
                            addMessage(response, 'received', "üéÆ");
                        });
                    });
                });
                
                // Track all clicks
                document.addEventListener('click', () => {
                    clickCount++;
                    updateStats();
                });
            }
            
            // Update UI state for photo booth
            function updateUI() {
                const photosTaken = capturedPhotos.filter(p => p).length;
                
                // Update capture button text
                if (currentSlot < 3) {
                    captureBtn.innerHTML = `<i class="fas fa-camera"></i> Take Photo ${currentSlot + 1}/3`;
                    captureBtn.disabled = !photoBoothActive;
                } else {
                    captureBtn.innerHTML = `<i class="fas fa-check"></i> All Photos Taken!`;
                    captureBtn.disabled = true;
                }
                
                // Enable/disable download button
                downloadBtn.disabled = photosTaken < 3;
                
                // Update download button text
                if (photosTaken === 3) {
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> Download Complete Strip!`;
                } else {
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> (${photosTaken}/3) Download`;
                }
            }
            
            // Update stats for original features
            function updateStats() {
                rainCountEl.textContent = rainCount;
                chocolateCountEl.textContent = totalChocolates;
                clickCountEl.textContent = clickCount;
            }
            
            // Show popup
            function showPopup(title, message, emoji) {
                document.getElementById('popup-emoji').textContent = emoji;
                document.getElementById('popup-title').textContent = title;
                document.getElementById('popup-message').textContent = message;
                chocolatePopup.classList.add('active');
                
                // Auto-close after 4 seconds
                setTimeout(() => {
                    chocolatePopup.classList.remove('active');
                }, 4000);
            }
            
            // Show message
            function showMessage(text, type) {
                // Create message element
                const messageEl = document.createElement('div');
                messageEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? 'linear-gradient(135deg, #4CAF50, #8BC34A)' : 
                                 type === 'warning' ? 'linear-gradient(135deg, #FF9800, #FFC107)' : 
                                 'linear-gradient(135deg, #2196F3, #03A9F4)'};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
                    z-index: 10000;
                    animation: slideIn 0.5s ease;
                    max-width: 300px;
                `;
                messageEl.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                        <span>${text}</span>
                    </div>
                `;
                
                document.body.appendChild(messageEl);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    messageEl.style.animation = 'slideOut 0.5s ease forwards';
                    setTimeout(() => messageEl.remove(), 500);
                }, 3000);
            }
            
            // Utility: Sleep function
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            // Add CSS for messages
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
                @keyframes wiggle {
                    0%, 100% { transform: rotate(-3deg); }
                    50% { transform: rotate(3deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Initialize everything
            initialize();
        });
    </script>
</body>
</html>
