<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Promise Day üíô</title>

  <style>
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", system-ui, sans-serif;
    }

    body {
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #e8f0ff, #fdfbff);
      color: #1f2937;
    }

    h1 {
      text-align: center;
      margin-bottom: 5px;
    }

    .subtitle {
      text-align: center;
      font-size: 0.95rem;
      opacity: 0.8;
      margin-bottom: 25px;
    }

    .input-area {
      max-width: 500px;
      margin: 0 auto 30px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    textarea {
      resize: none;
      height: 120px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #c7d2fe;
      font-size: 1rem;
    }

    button {
      padding: 12px;
      border-radius: 999px;
      border: none;
      background: #4f46e5;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.15s ease, opacity 0.15s ease;
    }

    button:hover {
      transform: scale(1.03);
      opacity: 0.95;
    }

    .wall {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f2eb;
      border-radius: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      min-height: 300px;
    }

    .promise-card {
      background: #ffffff;
      width: 180px;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 10px 18px rgba(0,0,0,0.1);
      position: relative;
      animation: dropIn 0.35s ease;
      transform: rotate(var(--rot));
    }

    .promise-card::before {
      content: "üìå";
      position: absolute;
      top: -14px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.2rem;
    }

    .promise-card p {
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .timestamp {
      margin-top: 8px;
      font-size: 0.7rem;
      opacity: 0.6;
    }

    .remove-btn {
      position: absolute;
      top: 6px;
      right: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      opacity: 0.6;
    }

    .remove-btn:hover {
      opacity: 1;
    }

    @keyframes dropIn {
      from {
        transform: translateY(-20px) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
  </style>
</head>

<body>

  <h1>Promise Day üíô</h1>
  <div class="subtitle">
    Promises aren‚Äôt words. They‚Äôre choices we keep making.
  </div>

  <div class="input-area">
    <textarea id="promiseInput" maxlength="200"
      placeholder="I promise to choose you, even on hard days‚Ä¶"></textarea>
    <button id="addPromise">Hang this promise üíô</button>
  </div>

  <div id="wall" class="wall"></div>

  <!-- Sounds -->
  <audio id="hangSound" src="assets/sounds/hang.mp3"></audio>
  <audio id="removeSound" src="assets/sounds/remove.mp3"></audio>

  <!-- Firebase + App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA0PcywZQvUzbwKiz0FTUpsHBu9naR8OUo",
      authDomain: "promise-c0cc6.firebaseapp.com",
      projectId: "promise-c0cc6",
      storageBucket: "promise-c0cc6.firebasestorage.app",
      messagingSenderId: "293474620918",
      appId: "1:293474620918:web:32997333d2dfb4fd48e3d7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const wall = document.getElementById("wall");
    const input = document.getElementById("promiseInput");
    const hangSound = document.getElementById("hangSound");
    const removeSound = document.getElementById("removeSound");

    document.getElementById("addPromise").onclick = async () => {
      const text = input.value.trim();
      if (!text) return;

      hangSound.currentTime = 0;
      hangSound.play();

      await addDoc(collection(db, "promises"), {
        text,
        createdAt: Date.now()
      });

      input.value = "";
      loadPromises();
    };

    async function loadPromises() {
      wall.innerHTML = "";
      const snapshot = await getDocs(collection(db, "promises"));

      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        createCard(docSnap.id, data.text, data.createdAt);
      });
    }

    function createCard(id, text, time) {
      const card = document.createElement("div");
      card.className = "promise-card";
      card.style.setProperty("--rot", `${Math.random() * 6 - 3}deg`);

      const date = new Date(time);
      const prettyDate = date.toLocaleDateString(undefined, {
        month: "short",
        day: "numeric"
      });

      card.innerHTML = `
        <span class="remove-btn">‚ùå</span>
        <p>${text}</p>
        <div class="timestamp">Hung on ${prettyDate} üíô</div>
      `;

      card.querySelector(".remove-btn").onclick = async () => {
        removeSound.currentTime = 0;
        removeSound.play();
        await deleteDoc(doc(db, "promises", id));
        card.remove();
      };

      wall.appendChild(card);
    }

    loadPromises();
  </script>

</body>
</html>
