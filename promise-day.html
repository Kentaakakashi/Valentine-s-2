<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Promise Day üíô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
      font-family: "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: #0f172a;
      color: #e5e7eb;
      padding: 20px;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 2.5rem;
    }

    textarea {
      width: 100%;
      max-width: 600px;
      height: 100px;
      padding: 12px;
      border-radius: 12px;
      border: none;
      resize: none;
      font-size: 1rem;
    }

    .center {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-bottom: 40px;
    }

    button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-wall {
      background: #38bdf8;
    }

    .btn-mine {
      background: #22c55e;
    }

    section {
      margin-bottom: 50px;
    }

    /* WALL */
    #wall {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .card {
      background: #1e293b;
      padding: 14px;
      width: 200px;
      border-radius: 14px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      position: relative;
      transform: rotate(calc(-2deg + 4deg * var(--r)));
    }

    .card small {
      opacity: 0.6;
      display: block;
      margin-top: 8px;
    }

    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .lock {
      cursor: pointer;
    }

    /* MY PROMISES */
    #my-promises {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }
  </style>
</head>
<body>

  <h1>Promise Day üíô</h1>
  <p style="text-align:center;opacity:.7">
    Words that matter. Kept until we choose otherwise.
  </p>

  <div class="center">
    <textarea id="promiseInput" placeholder="Write a promise..."></textarea>
    <div>
      <button class="btn-wall" onclick="addWallPromise()">Hang on Wall</button>
      <button class="btn-mine" onclick="addMyPromise()">Add to My Promises</button>
    </div>
  </div>

  <section>
    <h2>üß± Promise Wall</h2>
    <div id="wall"></div>
  </section>

  <section>
    <h2>üíô My Promises</h2>
    <div id="my-promises"></div>
  </section>

  <!-- SOUNDS -->
  <audio id="hangSound" src="assets/sounds/hang.mp3"></audio>
  <audio id="deleteSound" src="assets/sounds/delete.mp3"></audio>
  <audio id="lockSound" src="assets/sounds/lock.mp3"></audio>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc,
      onSnapshot, deleteDoc, doc, updateDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA0PcywZQvUzbwKiz0FTUpsHBu9naR8OUo",
      authDomain: "promise-c0cc6.firebaseapp.com",
      projectId: "promise-c0cc6",
      storageBucket: "promise-c0cc6.firebasestorage.app",
      messagingSenderId: "293474620918",
      appId: "1:293474620918:web:32997333d2dfb4fd48e3d7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const input = document.getElementById("promiseInput");
    const wall = document.getElementById("wall");
    const mine = document.getElementById("my-promises");

    const hangSound = document.getElementById("hangSound");
    const deleteSound = document.getElementById("deleteSound");
    const lockSound = document.getElementById("lockSound");

    window.addWallPromise = async () => {
      if (!input.value.trim()) return;
      await addDoc(collection(db, "promises"), {
        text: input.value,
        createdAt: Date.now(),
        locked: false
      });
      hangSound.play();
      input.value = "";
    };

    window.addMyPromise = async () => {
      if (!input.value.trim()) return;
      await addDoc(collection(db, "myPromises"), {
        text: input.value,
        createdAt: Date.now(),
        locked: false
      });
      hangSound.play();
      input.value = "";
    };

    function renderCard(data, id, isWall) {
      const card = document.createElement("div");
      card.className = "card";
      card.style.setProperty("--r", Math.random());

      const time = Math.floor((Date.now() - data.createdAt) / 86400000);

      card.innerHTML = `
        <div>${data.text}</div>
        <small>${time} day(s) ago</small>
        <div class="actions">
          <span class="lock">${data.locked ? "üîí" : "üîì"}</span>
          <span class="del">üóëÔ∏è</span>
        </div>
      `;

      card.querySelector(".del").onclick = async () => {
        if (confirm("Remove this promise?")) {
          await deleteDoc(doc(db, isWall ? "promises" : "myPromises", id));
          deleteSound.play();
        }
      };

      card.querySelector(".lock").onclick = async () => {
        await updateDoc(
          doc(db, isWall ? "promises" : "myPromises", id),
          { locked: !data.locked }
        );
        lockSound.play();
      };

      return card;
    }

    onSnapshot(collection(db, "promises"), snap => {
      wall.innerHTML = "";
      snap.forEach(docu => {
        wall.appendChild(renderCard(docu.data(), docu.id, true));
      });
    });

    onSnapshot(collection(db, "myPromises"), snap => {
      mine.innerHTML = "";
      snap.forEach(docu => {
        mine.appendChild(renderCard(docu.data(), docu.id, false));
      });
    });
  </script>

</body>
</html>
